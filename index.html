<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="World Clock with analog and digital displays, timezone info, and time difference calculator." />
<title>World Clock & Time Difference Calculator</title>
<style>
  /* Base day theme */
  body {
    margin: 0; padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f9f9f9;
    color: #222;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  /* Night theme */
  body.night-mode {
    background: #121212;
    color: #ddd;
  }

  h1, h2 {
    font-weight: 600;
    margin-bottom: 0.25em;
  }
  .container {
    max-width: 1000px;
    margin: auto;
  }
  .clocks {
    display: flex;
    gap: 24px;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 40px;
  }
  .clock {
    background: white;
    border: 3px solid #3a86ff;
    border-radius: 12px;
    width: 240px;
    padding: 16px;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
    text-align: center;
    transition: filter 0.5s ease, opacity 0.5s ease, background-color 0.3s ease, color 0.3s ease;
  }
  /* Dark mode clock styling */
  body.night-mode .clock {
    background: #1e1e1e;
    border-color: #5599ff;
    box-shadow: 0 4px 12px rgba(85, 153, 255, 0.8);
    color: #eee;
  }
  .clock.night {
    filter: brightness(0.6);
    opacity: 0.7;
  }
  .city-name {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 4px;
  }
  .tz-info {
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 12px;
  }
  /* Dark mode tz-info */
  body.night-mode .tz-info {
    color: #bbb;
  }

  .digital {
    font-family: monospace;
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    margin-bottom: 20px;
  }
  .analog-face {
    position: relative;
    width: 180px;
    height: 180px;
    margin: 0 auto;
    border: 4px solid #3a86ff;
    border-radius: 50%;
    background: white;
    box-sizing: border-box;
  }
  /* Dark mode analog face */
  body.night-mode .analog-face {
    border-color: #5599ff;
    background: #222;
  }

  .analog-face .number {
    position: absolute;
    font-weight: 700;
    font-size: 1.2rem;
    color: #222;
    user-select: none;
  }
  body.night-mode .analog-face .number {
    color: #ccc;
  }

  .hand {
    position: absolute;
    bottom: 50%;
    left: 50%;
    border-radius: 3px;
    transform-origin: bottom center;
    transition: transform 0.3s ease-in-out;
  }
  .hand-hour {
    width: 6px;
    height: 45px;
    margin-left: -3px;
    background: #3a86ff;
  }
  .hand-minute {
    width: 4px;
    height: 65px;
    margin-left: -2px;
    background: #1e6091;
  }
  .hand-second {
    width: 2px;
    height: 75px;
    margin-left: -1px;
    background: #ff4d6d;
  }
  /* Dark mode hands */
  body.night-mode .hand-hour {
    background: #5599ff;
  }
  body.night-mode .hand-minute {
    background: #3366cc;
  }
  body.night-mode .hand-second {
    background: #ff6677;
  }

  .center-dot {
    position: absolute;
    width: 12px;
    height: 12px;
    background: #222;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    margin-top: -6px;
    margin-left: -6px;
    z-index: 10;
  }
  body.night-mode .center-dot {
    background: #eee;
  }

  .controls {
    max-width: 600px;
    margin: 0 auto 3rem;
  }
  label {
    display: block;
    margin: 1em 0 0.25em;
    font-weight: 600;
  }
  select, input[type=date], input[type=time] {
    width: 100%;
    padding: 0.35em 0.5em;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  body.night-mode select,
  body.night-mode input[type=date],
  body.night-mode input[type=time] {
    background-color: #333;
    color: #eee;
    border-color: #666;
  }

  button {
    margin-top: 1.5em;
    padding: 0.6em 1.2em;
    font-size: 1rem;
    font-weight: 700;
    color: white;
    background-color: #3a86ff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #265fbf;
  }
  .result {
    margin-top: 1.5em;
    font-weight: 600;
    font-size: 1.1rem;
    color: #111;
  }
  body.night-mode .result {
    color: #ddd;
  }

  @media (max-width: 650px) {
    .clocks {
      flex-direction: column;
      align-items: center;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>World Clock & Time Difference Calculator</h1>

    <section class="controls" aria-label="Settings">
      <label for="themeToggle">Theme Mode:</label>
      <select id="themeToggle" aria-label="Select Day or Night mode">
        <option value="auto" selected>Auto (based on local time)</option>
        <option value="day">Day Mode</option>
        <option value="night">Night Mode</option>
      </select>

      <label for="clockStyle">Clock Display Style:</label>
      <select id="clockStyle" aria-label="Select clock display style">
        <option value="default" selected>Default (Analog + Digital)</option>
        <option value="digital">Digital Only</option>
        <option value="analog">Analog Only</option>
      </select>
    </section>

    <section class="clocks" id="clocks"></section>

    <section class="controls" aria-label="Time difference calculator">
      <h2>Calculate Time Difference</h2>

      <label for="calcCityA">City A:</label>
      <select id="calcCityA"></select>

      <label for="calcCityB">City B:</label>
      <select id="calcCityB"></select>

      <label for="calcDate">Date:</label>
      <input type="date" id="calcDate" />

      <label for="calcTime">Time:</label>
      <input type="time" id="calcTime" step="60" />

      <button id="calcButton">Calculate Difference</button>

      <div class="result" id="calcResult" aria-live="polite" aria-atomic="true"></div>
    </section>
  </div>

<script>
  const cities = [
    { id: 'america_new_york', name: 'New York', tz: 'America/New_York' },
    { id: 'europe_london', name: 'London', tz: 'Europe/London' },
    { id: 'asia_tokyo', name: 'Tokyo', tz: 'Asia/Tokyo' },
    { id: 'europe_berlin', name: 'Berlin', tz: 'Europe/Berlin' },
    { id: 'australia_sydney', name: 'Sydney', tz: 'Australia/Sydney' },
    { id: 'america_los_angeles', name: 'Los Angeles', tz: 'America/Los_Angeles' },
    { id: 'asia_singapore', name: 'Singapore', tz: 'Asia/Singapore' },
  ];

  const clocksContainer = document.getElementById('clocks');
  const themeToggle = document.getElementById('themeToggle');
  const clockStyleSelect = document.getElementById('clockStyle');

  // Populate dropdowns for calculator
  const calcCityA = document.getElementById('calcCityA');
  const calcCityB = document.getElementById('calcCityB');
  const calcDate = document.getElementById('calcDate');
  const calcTime = document.getElementById('calcTime');
  const calcResult = document.getElementById('calcResult');
  const calcButton = document.getElementById('calcButton');

  // Initialize calculator city selects
  cities.forEach(city => {
    const optionA = document.createElement('option');
    optionA.value = city.id;
    optionA.textContent = city.name;
    calcCityA.appendChild(optionA);

    const optionB = document.createElement('option');
    optionB.value = city.id;
    optionB.textContent = city.name;
    calcCityB.appendChild(optionB);
  });

  // Set default calculator values
  const nowISO = new Date().toISOString();
  calcDate.value = nowISO.slice(0, 10);
  calcTime.value = nowISO.slice(11, 16);
  calcCityA.value = 'america_new_york';
  calcCityB.value = 'asia_tokyo';

  // Variables to hold clock elements and info
  let clockElements = [];

  // Create clock HTML elements for one city, with all styles
  function createClockElem(city) {
    const clock = document.createElement('article');
    clock.className = 'clock';
    clock.setAttribute('aria-label', `Clock for ${city.name}`);

    const cityName = document.createElement('div');
    cityName.className = 'city-name';
    cityName.textContent = city.name;
    clock.appendChild(cityName);

    const tzInfo = document.createElement('div');
    tzInfo.className = 'tz-info';
    tzInfo.textContent = city.tz;
    clock.appendChild(tzInfo);

    // Digital display
    const digital = document.createElement('div');
    digital.className = 'digital';
    clock.appendChild(digital);

    // Analog face container
    const analogFace = document.createElement('div');
    analogFace.className = 'analog-face';

    // Clock numbers 1-12
    for (let n = 1; n <= 12; n++) {
      const num = document.createElement('div');
      num.className = 'number';
      num.textContent = n;
      const angle = (n * 30) - 90; // start at top
      const radius = 75;
      const rad = angle * Math.PI / 180;
      const x = 90 + Math.cos(rad) * radius - 10;
      const y = 90 + Math.sin(rad) * radius - 14;
      num.style.left = `${x}px`;
      num.style.top = `${y}px`;
      analogFace.appendChild(num);
    }

    // Hour hand
    const hourHand = document.createElement('div');
    hourHand.className = 'hand hand-hour';
    analogFace.appendChild(hourHand);

    // Minute hand
    const minuteHand = document.createElement('div');
    minuteHand.className = 'hand hand-minute';
    analogFace.appendChild(minuteHand);

    // Second hand
    const secondHand = document.createElement('div');
    secondHand.className = 'hand hand-second';
    analogFace.appendChild(secondHand);

    // Center dot
    const centerDot = document.createElement('div');
    centerDot.className = 'center-dot';
    analogFace.appendChild(centerDot);

    clock.appendChild(analogFace);

    return { clock, city, digital, analogFace, hourHand, minuteHand, secondHand };
  }

  // Initialize clocks for all cities
  function initClocks() {
    clocksContainer.innerHTML = '';
    clockElements = cities.map(city => createClockElem(city));
    clockElements.forEach(c => clocksContainer.appendChild(c.clock));
  }

  // Update clocks: time, angles, night dimming, and display style
  function updateClocks() {
    const now = new Date();

    clockElements.forEach(({ clock, city, digital, analogFace, hourHand, minuteHand, secondHand }) => {
      // Get local time in city timezone
      const nowCity = new Date(now.toLocaleString('en-US', { timeZone: city.tz }));

      // Digital display HH:mm:ss
      digital.textContent = nowCity.toLocaleTimeString('en-GB', { hour12: false });

      // Calculate angles for analog hands
      const h = nowCity.getHours() % 12;
      const m = nowCity.getMinutes();
      const s = nowCity.getSeconds();

      const hourAngle = (h * 30) + (m * 0.5);
      const minuteAngle = (m * 6) + (s * 0.1);
      const secondAngle = s * 6;

      hourHand.style.transform = `rotate(${hourAngle}deg)`;
      minuteHand.style.transform = `rotate(${minuteAngle}deg)`;
      secondHand.style.transform = `rotate(${secondAngle}deg)`;

      // Determine night dimming based on clock local time (20:00-06:00)
      const isNight = nowCity.getHours() >= 20 || nowCity.getHours() < 6;

      // Apply night dimming based on theme toggle mode
      if (themeToggle.value === 'auto') {
        if (isNight) {
          clock.classList.add('night');
        } else {
          clock.classList.remove('night');
        }
      } else if (themeToggle.value === 'night') {
        clock.classList.add('night');
      } else {
        clock.classList.remove('night');
      }
    });
  }

  // Apply theme mode to body
  function applyThemeMode() {
    if (themeToggle.value === 'night') {
      document.body.classList.add('night-mode');
    } else if (themeToggle.value === 'day') {
      document.body.classList.remove('night-mode');
    } else if (themeToggle.value === 'auto') {
      // Auto: determine based on user's local time (20:00-06:00 night)
      const hour = new Date().getHours();
      if (hour >= 20 || hour < 6) {
        document.body.classList.add('night-mode');
      } else {
        document.body.classList.remove('night-mode');
      }
    }
  }

  // Apply clock style (default / digital / analog)
  function applyClockStyle() {
    clockElements.forEach(({ clock, digital, analogFace }) => {
      const style = clockStyleSelect.value;
      if (style === 'default') {
        digital.style.display = 'block';
        analogFace.style.display = 'block';
      } else if (style === 'digital') {
        digital.style.display = 'block';
        analogFace.style.display = 'none';
      } else if (style === 'analog') {
        digital.style.display = 'none';
        analogFace.style.display = 'block';
      }
    });
  }

  // Calculate time difference between two cities for given date and time
  calcButton.addEventListener('click', () => {
    const cityA = cities.find(c => c.id === calcCityA.value);
    const cityB = cities.find(c => c.id === calcCityB.value);

    if (!cityA || !cityB) {
      calcResult.textContent = 'Please select both cities.';
      return;
    }
    if (!calcDate.value || !calcTime.value) {
      calcResult.textContent = 'Please select a valid date and time.';
      return;
    }

    // Parse date/time as if local in city A timezone
    const dateTimeStr = `${calcDate.value}T${calcTime.value}:00`;

    // Helper: get offset in minutes between UTC and local time in timeZone at a given Date
    function getOffsetMinutes(timeZone, date) {
      const dtf = new Intl.DateTimeFormat('en-US', {
        timeZone,
        hour12: false,
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      const parts = dtf.formatToParts(date);
      const map = {};
      parts.forEach(({ type, value }) => {
        map[type] = value;
      });
      const asUTC = Date.UTC(
        +map.year, +map.month - 1, +map.day,
        +map.hour, +map.minute, +map.second
      );
      return (date.getTime() - asUTC) / 60000;
    }

    // Parse date/time as UTC but will adjust by offset to get actual city local time
    const localDateA = new Date(dateTimeStr + 'Z');
    const offsetA = getOffsetMinutes(cityA.tz, localDateA);
    const cityALocalTime = new Date(localDateA.getTime() - offsetA * 60000);

    const offsetB = getOffsetMinutes(cityB.tz, cityALocalTime);
    const cityBLocalTime = new Date(cityALocalTime.getTime() + offsetB * 60000);

    // Calculate difference in hours/minutes
    const diffMs = cityBLocalTime.getTime() - cityALocalTime.getTime();
    const diffMins = Math.round(diffMs / 60000);
    const sign = diffMins >= 0 ? '+' : '-';
    const absMins = Math.abs(diffMins);
    const h = Math.floor(absMins / 60);
    const m = absMins % 60;

    calcResult.textContent = `${cityB.name} is ${sign}${h}h ${m}m relative to ${cityA.name}`;
  });

  // Event listeners
  themeToggle.addEventListener('change', () => {
    applyThemeMode();
    updateClocks();
  });

  clockStyleSelect.addEventListener('change', () => {
    applyClockStyle();
  });

  // Initialize
  initClocks();
  applyThemeMode();
  applyClockStyle();
  setInterval(() => {
    updateClocks();
    applyThemeMode();
  }, 1000);
</script>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #eee;
    color: #333;
    margin: 0;
    padding: 1rem;
  }
  body.night-mode {
    background: #121212;
    color: #eee;
  }
  #clocks {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }
  .clock {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    padding: 1rem;
    width: 220px;
    transition: background-color 0.5s, color 0.5s;
  }
  .clock.night {
    background: #222;
    color: #ccc;
  }
  .city-name {
    font-weight: bold;
    font-size: 1.2rem;
  }
  .tz-info {
    font-size: 0.8rem;
    color: #666;
    margin-bottom: 0.5rem;
  }
  .digital {
    font-family: 'Courier New', monospace;
    font-size: 1.5rem;
    text-align: center;
    margin-bottom: 1rem;
  }
  .analog-face {
    position: relative;
    width: 180px;
    height: 180px;
    margin: 0 auto;
    border: 3px solid #333;
    border-radius: 50%;
    background: #fafafa;
  }
  body.night-mode .analog-face {
    border-color: #ccc;
    background: #333;
  }
  .number {
    position: absolute;
    font-weight: bold;
    font-size: 1rem;
    user-select: none;
  }
  .hand {
    position: absolute;
    background: #333;
    border-radius: 2px;
    left: 50%;
    top: 50%;
    transform-origin: bottom center;
    transition: transform 0.5s ease-in-out;
  }
  .hand-hour {
    width: 6px;
    height: 50px;
    margin-left: -3px;
    margin-top: -50px;
  }
  .hand-minute {
    width: 4px;
    height: 70px;
    margin-left: -2px;
    margin-top: -70px;
  }
  .hand-second {
    width: 2px;
    height: 80px;
    margin-left: -1px;
    margin-top: -80px;
    background: red;
  }
  .center-dot {
    position: absolute;
    width: 12px;
    height: 12px;
    background: #333;
    border-radius: 50%;
    left: 50%;
    top: 50%;
    margin-left: -6px;
    margin-top: -6px;
  }
  body.night-mode .hand {
    background: #eee;
  }
  body.night-mode .hand-second {
    background: #f66;
  }
</style>

<div>
  <label for="themeToggle">Theme Mode:</label>
  <select id="themeToggle">
    <option value="auto">Auto</option>
    <option value="day">Day</option>
    <option value="night">Night</option>
  </select>

  <label for="clockStyle">Clock Style:</label>
  <select id="clockStyle">
    <option value="default">Default (Digital + Analog)</option>
    <option value="digital">Digital Only</option>
    <option value="analog">Analog Only</option>
  </select>
</div>

<div id="clocks"></div>

<div style="margin-top: 2rem; border-top: 1px solid #ccc; padding-top: 1rem;">
  <h3>Time Difference Calculator</h3>
  <label for="calcCityA">From:</label>
  <select id="calcCityA"></select>
  <label for="calcCityB">To:</label>
  <select id="calcCityB"></select>
  <label for="calcDate">Date:</label>
  <input type="date" id="calcDate" />
  <label for="calcTime">Time:</label>
  <input type="time" id="calcTime" step="1" />
  <button id="calcButton">Calculate</button>
  <div id="calcResult" style="margin-top: 1rem; font-weight: bold;"></div>
</div>
