<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>World Clocks</title>
  <meta name="description" content="A clean, user-friendly world clock application. Add and customize multiple clocks, switch between analog and digital, and organize your layout.">
  <meta name="keywords" content="world clock, time zones, current time, digital clock, analog clock, time converter, draggable clock">

  <!-- SortableJS for Draggable Layout -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

  <style>
    :root {
      --bg-color: #f0f2f5;
      --card-bg-color: #ffffff;
      --text-color: #1c1e21;
      --secondary-text-color: #65676b;
      --border-color: #ced0d4;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --header-bg-color: #ffffff;
      --button-bg-color: #e4e6eb;
      --button-hover-bg-color: #d8dadf;
    }

    .dark-mode {
      --bg-color: #18191a;
      --card-bg-color: #242526;
      --text-color: #e4e6eb;
      --secondary-text-color: #b0b3b8;
      --border-color: #3a3b3c;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --header-bg-color: #242526;
      --button-bg-color: #3a3b3c;
      --button-hover-bg-color: #4e4f50;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
    }

    .header {
      text-align: center;
      padding: 20px 10px;
      border-bottom: 1px solid var(--border-color);
      background-color: var(--header-bg-color);
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 4px var(--shadow-color);
    }

    .header h1 {
      margin: 0;
      font-size: 2rem;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 25px 0;
      padding: 0 15px;
    }

    .controls input[type="text"] {
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 20px;
      background-color: var(--button-bg-color);
      color: var(--text-color);
      font-size: 1rem;
      width: 250px;
      outline: none;
    }
     .controls input[type="text"]:focus {
        border-color: #1877f2;
     }

    .controls button {
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      background-color: #1877f2;
      color: white;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .controls button:hover {
      background-color: #166fe5;
    }

    .clock-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 25px;
      padding: 0 20px 80px 20px; /* Padding at bottom for footer */
    }

    .clock-card {
      background-color: var(--card-bg-color);
      border-radius: 15px;
      box-shadow: 0 4px 12px var(--shadow-color);
      text-align: center;
      width: 300px;
      padding: 20px;
      transition: background-color 0.3s, box-shadow 0.3s;
      cursor: grab;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 320px;
    }
    
    .clock-header {
        text-align: left;
        margin-bottom: 15px;
    }
    
    .clock-header h3 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
    }

    .clock-header p {
        margin: 5px 0 0;
        font-size: 0.9rem;
        color: var(--secondary-text-color);
    }
    
    .time-display {
        flex-grow: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .digital-time {
      font-size: 4rem;
      font-weight: 700;
      letter-spacing: -2px;
    }
    
    .analog-clock-canvas {
        max-width: 100%;
        max-height: 180px;
    }

    .card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
    }

    .card-footer button {
        background: none;
        border: 1px solid var(--border-color);
        color: var(--secondary-text-color);
        border-radius: 6px;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: background-color 0.2s, color 0.2s;
    }

    .card-footer button:hover {
        background-color: var(--button-bg-color);
        color: var(--text-color);
    }
    
    .remove-btn {
        background-color: #fa3e3e20 !important;
        color: #fa3e3e !important;
        border: 1px solid #fa3e3e50 !important;
    }
    .remove-btn:hover {
        background-color: #fa3e3e !important;
        color: white !important;
    }

    .theme-toggle-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      border: 1px solid var(--border-color);
      background-color: var(--card-bg-color);
      cursor: pointer;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      transition: transform 0.2s;
    }
    .theme-toggle-btn:hover {
        transform: scale(1.1);
    }

    footer {
      text-align: center;
      padding: 20px;
      font-size: 0.9rem;
      color: var(--secondary-text-color);
      background-color: var(--header-bg-color);
      border-top: 1px solid var(--border-color);
      position: fixed;
      bottom: 0;
      width: 100%;
    }

  </style>
</head>
<body>

<header class="header">
  <h1>World Clocks</h1>
</header>

<button class="theme-toggle-btn" id="theme-toggle">🌙</button>

<div class="controls">
  <input type="text" id="cityInput" placeholder="Enter a city (e.g., Paris)">
  <button onclick="addClockFromInput()">Add Clock</button>
</div>

<div class="clock-container" id="clocks"></div>

<footer>
  Powered by LulssuLabs
</footer>

<script>
  const clocksContainer = document.getElementById('clocks');
  const cityInput = document.getElementById('cityInput');
  const themeToggle = document.getElementById('theme-toggle');

  let clockIntervals = {};

  // --- Core Functions ---

  function addClockFromInput() {
    const city = cityInput.value.trim();
    if (!city) {
        alert('Please enter a city name.');
        return;
    }
    addNewClock(city, 'digital');
    cityInput.value = '';
  }
  
  async function addNewClock(city, style) {
    const timezone = await findTimezone(city);
    if (!timezone) {
        alert(`Could not find a timezone for "${city}". Please try a different or more specific city name.`);
        return;
    }

    const clockId = `clock-${Date.now()}`;
    const clockCard = document.createElement('div');
    clockCard.className = 'clock-card';
    clockCard.id = clockId;
    clockCard.dataset.timezone = timezone;
    clockCard.dataset.city = city;
    clockCard.dataset.style = style;
    
    clockCard.innerHTML = `
        <div class="clock-header">
            <h3 class="city-name">${city.charAt(0).toUpperCase() + city.slice(1)}</h3>
            <p class="timezone-name">${timezone.replace(/_/g, ' ')}</p>
        </div>
        <div class="time-display">Loading...</div>
        <div class="card-footer">
            <button class="toggle-style-btn">Switch to ${style === 'digital' ? 'Analog' : 'Digital'}</button>
            <button class="remove-btn">Remove</button>
        </div>
    `;

    clocksContainer.appendChild(clockCard);

    clockIntervals[clockId] = setInterval(() => updateClock(clockCard), 1000);
    updateClock(clockCard); // Initial call

    // Add event listeners for the new card's buttons
    clockCard.querySelector('.remove-btn').addEventListener('click', () => removeClock(clockId));
    clockCard.querySelector('.toggle-style-btn').addEventListener('click', () => toggleClockStyle(clockId));
  }

  function updateClock(clockCard) {
    const timezone = clockCard.dataset.timezone;
    const style = clockCard.dataset.style;
    const displayElement = clockCard.querySelector('.time-display');

    try {
        const time = new Date().toLocaleTimeString('en-US', { timeZone: timezone, hour12: false });
        const date = new Date();
        const tzTime = new Date(date.toLocaleString('en-US', { timeZone: timezone }));
        
        if (style === 'digital') {
            const [hours, minutes, seconds] = time.split(':');
            displayElement.innerHTML = `<div class="digital-time">${hours}:${minutes}</div>`;
        } else {
            displayElement.innerHTML = `<canvas class="analog-clock-canvas" width="200" height="200"></canvas>`;
            drawAnalog(displayElement.querySelector('canvas'), tzTime);
        }
    } catch (e) {
        displayElement.innerHTML = "Invalid Timezone";
        clearInterval(clockIntervals[clockCard.id]);
    }
  }

  function removeClock(clockId) {
    clearInterval(clockIntervals[clockId]);
    delete clockIntervals[clockId];
    document.getElementById(clockId).remove();
  }
  
  function toggleClockStyle(clockId) {
      const clockCard = document.getElementById(clockId);
      const currentStyle = clockCard.dataset.style;
      const newStyle = currentStyle === 'digital' ? 'analog' : 'digital';
      clockCard.dataset.style = newStyle;

      const toggleButton = clockCard.querySelector('.toggle-style-btn');
      toggleButton.textContent = `Switch to ${newStyle === 'digital' ? 'Analog' : 'Digital'}`;
      
      updateClock(clockCard); // Immediately update view
  }

  async function findTimezone(city) {
    // This is a simplified lookup. A more robust solution might use a dedicated API or a larger local list.
    // For now, we'll try to find a match in the IANA database via an external API.
    try {
        // Using worldtimeapi.org to find a matching timezone
        const response = await fetch(`https://worldtimeapi.org/api/timezone`);
        const timezones = await response.json();
        const found = timezones.find(tz => tz.toLowerCase().includes(city.toLowerCase().replace(' ', '_')));
        return found || null;
    } catch (error) {
        console.error("Error fetching timezone list:", error);
        return null;
    }
  }
  
  // --- Analog Clock Drawing ---
  
  function drawAnalog(canvas, time) {
    const ctx = canvas.getContext('2d');
    const radius = canvas.height / 2;
    const isDarkMode = document.body.classList.contains('dark-mode');
    
    ctx.translate(radius, radius);

    // Clear canvas and set styles
    ctx.clearRect(-radius, -radius, canvas.width, canvas.height);
    const primaryColor = isDarkMode ? '#e4e6eb' : '#1c1e21';
    const secondaryColor = isDarkMode ? '#b0b3b8' : '#65676b';
    const accentColor = '#fa3e3e';

    // Draw clock face
    ctx.beginPath();
    ctx.arc(0, 0, radius * 0.95, 0, 2 * Math.PI);
    ctx.fillStyle = isDarkMode ? '#242526' : '#ffffff';
    ctx.fill();
    ctx.strokeStyle = primaryColor;
    ctx.lineWidth = 4;
    ctx.stroke();
    
    // Draw center pin
    ctx.beginPath();
    ctx.arc(0, 0, 5, 0, 2 * Math.PI);
    ctx.fillStyle = primaryColor;
    ctx.fill();

    // Draw numbers
    ctx.font = `bold ${radius * 0.15}px Arial`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = primaryColor;
    for (let num = 1; num <= 12; num++) {
      const ang = num * Math.PI / 6;
      ctx.rotate(ang);
      ctx.translate(0, -radius * 0.78);
      ctx.rotate(-ang);
      ctx.fillText(num.toString(), 0, 0);
      ctx.rotate(ang);
      ctx.translate(0, radius * 0.78);
      ctx.rotate(-ang);
    }

    // Get time parts
    const hour = time.getHours() % 12;
    const minute = time.getMinutes();
    const second = time.getSeconds();

    // Draw hands
    // Hour
    const hourAngle = (hour * Math.PI / 6) + (minute * Math.PI / (6 * 60)) + (second * Math.PI / (360 * 60));
    drawHand(ctx, hourAngle, radius * 0.5, 7, primaryColor);
    // Minute
    const minuteAngle = (minute * Math.PI / 30) + (second * Math.PI / (30 * 60));
    drawHand(ctx, minuteAngle, radius * 0.7, 5, primaryColor);
    // Second
    const secondAngle = (second * Math.PI / 30);
    drawHand(ctx, secondAngle, radius * 0.85, 2, accentColor);
    
    ctx.translate(-radius, -radius); // Reset transform
  }

  function drawHand(ctx, pos, length, width, color) {
    ctx.beginPath();
    ctx.lineWidth = width;
    ctx.lineCap = 'round';
    ctx.strokeStyle = color;
    ctx.moveTo(0, 0);
    ctx.rotate(pos);
    ctx.lineTo(0, -length);
    ctx.stroke();
    ctx.rotate(-pos);
  }

  // --- Theme Toggling ---

  function toggleTheme() {
    const isDark = document.body.classList.toggle('dark-mode');
    themeToggle.textContent = isDark ? '☀️' : '🌙';
    localStorage.setItem('theme', isDark ? 'dark' : 'light');

    // Redraw analog clocks for new theme colors
    Object.keys(clockIntervals).forEach(id => {
        const clockCard = document.getElementById(id);
        if(clockCard.dataset.style === 'analog') {
            updateClock(clockCard);
        }
    });
  }

  // --- Initialization ---

  document.addEventListener('DOMContentLoaded', () => {
    // Draggable functionality
    new Sortable(clocksContainer, {
        animation: 150,
        ghostClass: 'sortable-ghost'
    });

    // Load theme
    if (localStorage.getItem('theme') === 'dark') {
        toggleTheme();
    }
    
    // Add default clocks
    addNewClock('New York', 'digital');
    addNewClock('London', 'digital');
    addNewClock('Tokyo', 'digital');

    // Add event listeners
    themeToggle.addEventListener('click', toggleTheme);
    cityInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            addClockFromInput();
        }
    });
  });

</script>

</body>
</html>
