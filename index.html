<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>World Clocks & Time Difference Calculator</title>
<style>
  /* Base styles */
  body {
    font-family: Arial, sans-serif;
    background: #f9f9f9;
    color: #222;
    margin: 0; padding: 20px;
    transition: background 0.5s, color 0.5s;
  }
  body.night {
    background: #121212;
    color: #ddd;
  }
  h1, h2 {
    margin-top: 0;
  }
  .container {
    max-width: 900px;
    margin: auto;
  }

  /* Clocks area */
  #clocks {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 30px;
  }
  .clock {
    background: #fff;
    border: 3px solid #2a7ae2;
    border-radius: 10px;
    padding: 15px;
    width: 280px;
    box-sizing: border-box;
    box-shadow: 0 4px 6px rgba(42, 122, 226, 0.3);
    transition: background 0.5s, border-color 0.5s, color 0.5s;
  }
  body.night .clock {
    background: #222;
    border-color: #5599ff;
    box-shadow: 0 4px 8px rgba(85, 153, 255, 0.6);
  }

  .city-name {
    font-weight: bold;
    font-size: 1.3em;
    margin-bottom: 6px;
  }
  .timezone-info {
    font-size: 0.9em;
    margin-bottom: 10px;
    color: #555;
  }
  body.night .timezone-info {
    color: #bbb;
  }

  /* Digital clock */
  .digital {
    font-family: 'Courier New', Courier, monospace;
    font-size: 1.7em;
    letter-spacing: 2px;
    margin-bottom: 12px;
  }

  /* Analog clock */
  .analog {
    position: relative;
    width: 180px;
    height: 180px;
    margin: auto;
    border: 4px solid #2a7ae2;
    border-radius: 50%;
    background: #fafafa;
    box-sizing: border-box;
  }
  body.night .analog {
    background: #111;
    border-color: #5599ff;
  }
  .analog .center-dot {
    position: absolute;
    background: #2a7ae2;
    width: 12px; height: 12px;
    border-radius: 50%;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
  }
  body.night .analog .center-dot {
    background: #5599ff;
  }
  .analog .hand {
    position: absolute;
    background: #2a7ae2;
    top: 50%;
    left: 50%;
    transform-origin: bottom center;
    transform: translateX(-50%);
    border-radius: 4px;
  }
  body.night .analog .hand {
    background: #5599ff;
  }
  .hand.hour {
    width: 8px;
    height: 50px;
    margin-top: -50px;
    z-index: 7;
  }
  .hand.minute {
    width: 6px;
    height: 70px;
    margin-top: -70px;
    z-index: 8;
  }
  .hand.second {
    width: 2px;
    height: 80px;
    margin-top: -80px;
    background: #e74c3c;
  }
  body.night .hand.second {
    background: #ff6b6b;
  }

  /* Numbers on clock face */
  .analog .number {
    position: absolute;
    font-weight: bold;
    font-size: 1.2em;
    color: #2a7ae2;
    user-select: none;
  }
  body.night .analog .number {
    color: #5599ff;
  }

  /* Controls */
  #controls {
    margin-bottom: 30px;
    background: #fff;
    border: 2px solid #2a7ae2;
    border-radius: 10px;
    padding: 15px;
    box-sizing: border-box;
  }
  body.night #controls {
    background: #222;
    border-color: #5599ff;
  }
  label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
  }
  select, button {
    padding: 6px 12px;
    font-size: 1em;
    border: 1.5px solid #2a7ae2;
    border-radius: 6px;
    margin-bottom: 12px;
    width: 100%;
    max-width: 300px;
    background: white;
    color: #222;
    cursor: pointer;
    transition: background 0.3s, color 0.3s;
  }
  body.night select, body.night button {
    background: #111;
    border-color: #5599ff;
    color: #ddd;
  }
  button:hover {
    background: #2a7ae2;
    color: white;
  }
  body.night button:hover {
    background: #5599ff;
  }

  /* Calculator styles */
  #timecalc {
    background: #fff;
    border: 2px solid #2a7ae2;
    border-radius: 10px;
    padding: 15px;
    max-width: 500px;
  }
  body.night #timecalc {
    background: #222;
    border-color: #5599ff;
  }
  #timecalc label {
    margin-top: 10px;
  }
  #result {
    margin-top: 15px;
    font-weight: bold;
  }

  /* Responsive */
  @media (max-width: 700px) {
    #clocks {
      flex-direction: column;
      align-items: center;
    }
    .clock {
      width: 90%;
    }
  }
</style>
</head>
<body>

<div class="container">
  <h1>World Clocks & Time Difference Calculator</h1>

  <div id="clocks">
    <!-- Clocks inserted here -->
  </div>

  <div id="controls">
    <label for="cityAddSelect">Add Clock (Select City):</label>
    <select id="cityAddSelect"></select>
    <button id="addClockBtn">Add Clock</button>
    <button id="toggleModeBtn">Switch to Night Mode</button>
  </div>

  <div id="timecalc">
    <h2>Time Difference Calculator</h2>
    <label for="calcCityA">City A:</label>
    <select id="calcCityA"></select>

    <label for="calcCityB">City B:</label>
    <select id="calcCityB"></select>

    <label for="calcDate">Date:</label>
    <input type="date" id="calcDate" />

    <label for="calcTime">Time (24h):</label>
    <input type="time" id="calcTime" step="60" />

    <button id="calcBtn">Calculate Difference</button>
    <div id="result"></div>
  </div>
</div>

<script>
  const cities = [
    {id: 'america_new_york', name: 'New York', tz: 'America/New_York'},
    {id: 'europe_london', name: 'London', tz: 'Europe/London'},
    {id: 'asia_tokyo', name: 'Tokyo', tz: 'Asia/Tokyo'},
    {id: 'europe_paris', name: 'Paris', tz: 'Europe/Paris'},
    {id: 'america_los_angeles', name: 'Los Angeles', tz: 'America/Los_Angeles'},
    {id: 'asia_shanghai', name: 'Shanghai', tz: 'Asia/Shanghai'},
    {id: 'asia_dubai', name: 'Dubai', tz: 'Asia/Dubai'},
    {id: 'america_sao_paulo', name: 'SÃ£o Paulo', tz: 'America/Sao_Paulo'},
    {id: 'africa_cairo', name: 'Cairo', tz: 'Africa/Cairo'},
    {id: 'oceania_sydney', name: 'Sydney', tz: 'Australia/Sydney'}
  ];

  let currentClocks = ['america_new_york', 'europe_london', 'asia_tokyo'];
  let isNightMode = false;

  const clocksContainer = document.getElementById('clocks');
  const cityAddSelect = document.getElementById('cityAddSelect');
  const addClockBtn = document.getElementById('addClockBtn');
  const toggleModeBtn = document.getElementById('toggleModeBtn');
  const calcCityA = document.getElementById('calcCityA');
  const calcCityB = document.getElementById('calcCityB');
  const calcDate = document.getElementById('calcDate');
  const calcTime = document.getElementById('calcTime');
  const calcBtn = document.getElementById('calcBtn');
  const resultDiv = document.getElementById('result');

  function populateCitySelects() {
    [cityAddSelect, calcCityA, calcCityB].forEach(select => {
      select.innerHTML = '';
      cities.forEach(city => {
        const option = document.createElement('option');
        option.value = city.id;
        option.textContent = city.name;
        select.appendChild(option);
      });
    });
  }

  // Create analog clock numbers positions
  const numberPositions = [
    {num: 12, top: '8px', left: '82px'},
    {num: 1, top: '27px', left: '130px'},
    {num: 2, top: '63px', left: '160px'},
    {num: 3, top: '82px', left: '170px'},
    {num: 4, top: '102px', left: '160px'},
    {num: 5, top: '140px', left: '130px'},
    {num: 6, top: '158px', left: '82px'},
    {num: 7, top: '140px', left: '36px'},
    {num: 8, top: '102px', left: '18px'},
    {num: 9, top: '82px', left: '6px'},
    {num: 10, top: '63px', left: '18px'},
    {num: 11, top: '27px', left: '36px'}
  ];

  // Create a single clock element for a city
  function createClockElement(city) {
    const clockDiv = document.createElement('div');
    clockDiv.className = 'clock';
    clockDiv.id = `clock-${city.id}`;

    const cityName = document.createElement('div');
    cityName.className = 'city-name';
    cityName.textContent = city.name;
    clockDiv.appendChild(cityName);

    const tzInfo = document.createElement('div');
    tzInfo.className = 'timezone-info';
    clockDiv.appendChild(tzInfo);

    const digitalClock = document.createElement('div');
    digitalClock.className = 'digital';
    clockDiv.appendChild(digitalClock);

    // Analog clock container
    const analog = document.createElement('div');
    analog.className = 'analog';
    clockDiv.appendChild(analog);

    // Add numbers on analog clock face
    numberPositions.forEach(pos => {
      const numDiv = document.createElement('div');
      numDiv.className = 'number';
      numDiv.textContent = pos.num;
      numDiv.style.top = pos.top;
      numDiv.style.left = pos.left;
      analog.appendChild(numDiv);
    });

    // Create hour, minute, second hands
    const hourHand = document.createElement('div');
    hourHand.className = 'hand hour';
    analog.appendChild(hourHand);

    const minuteHand = document.createElement('div');
    minuteHand.className = 'hand minute';
    analog.appendChild(minuteHand);

    const secondHand = document.createElement('div');
    secondHand.className = 'hand second';
    analog.appendChild(secondHand);

    // Center dot
    const centerDot = document.createElement('div');
    centerDot.className = 'center-dot';
    analog.appendChild(centerDot);

    return clockDiv;
  }

  // Update all clocks display
  function updateClocks() {
    currentClocks.forEach(cityId => {
      const city = cities.find(c => c.id === cityId);
      if (!city) return;

      const clockDiv = document.getElementById(`clock-${city.id}`);
      if (!clockDiv) return;

      const tzInfo = clockDiv.querySelector('.timezone-info');
      const digitalClock = clockDiv.querySelector('.digital');
      const hourHand = clockDiv.querySelector('.hand.hour');
      const minuteHand = clockDiv.querySelector('.hand.minute');
      const secondHand = clockDiv.querySelector('.hand.second');

      // Get now in city timezone
      const now = new Date();
      const options = {
        timeZone: city.tz,
        hour12: false,
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        weekday: 'short',
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      };
      const localeTimeStr = now.toLocaleString('en-US', options);

      // Parse time parts for digital clock and analog clock
      const timeParts = localeTimeStr.match(/(\d{2}):(\d{2}):(\d{2})/);
      const weekday = localeTimeStr.split(',')[0];
      const dateStr = localeTimeStr.split(',')[1].trim();

      if (!timeParts) return;
      const h = parseInt(timeParts[1], 10);
      const m = parseInt(timeParts[2], 10);
      const s = parseInt(timeParts[3], 10);

      // Set digital clock
      digitalClock.textContent = `${pad(h)}:${pad(m)}:${pad(s)} (${weekday})`;

      // Set timezone info: offset, DST status
      const tzOffsetMinutes = getTimezoneOffsetMinutes(city.tz, now);
      const offsetHours = Math.floor(Math.abs(tzOffsetMinutes) / 60);
      const offsetMins = Math.abs(tzOffsetMinutes) % 60;
      const offsetSign = tzOffsetMinutes <= 0 ? '+' : '-';
      const dstActive = isDST(city.tz, now) ? 'Yes' : 'No';

      tzInfo.textContent = `TimeZone: ${city.tz}, UTC${offsetSign}${pad(offsetHours)}:${pad(offsetMins)} | DST: ${dstActive}`;

      // Update analog clock hands rotation
      // Hour hand rotation = 30 degrees per hour + 0.5 degrees per minute
      const hourAngle = (h % 12) * 30 + (m * 0.5);
      // Minute hand rotation = 6 degrees per minute
      const minuteAngle = m * 6;
      // Second hand rotation = 6 degrees per second
      const secondAngle = s * 6;

      hourHand.style.transform = `translateX(-50%) rotate(${hourAngle}deg)`;
      minuteHand.style.transform = `translateX(-50%) rotate(${minuteAngle}deg)`;
      secondHand.style.transform = `translateX(-50%) rotate(${secondAngle}deg)`;
    });
  }

  // Helper: pad number with leading zero
  function pad(num) {
    return num.toString().padStart(2, '0');
  }

  // Helper: Get timezone offset in minutes for a specific timezone and date
  function getTimezoneOffsetMinutes(tz, date) {
    const dt = new Date(date.toLocaleString('en-US', { timeZone: tz }));
    return (date.getTime() - dt.getTime()) / (60 * 1000);
  }

  // Helper: Determine if DST is active in a timezone at a date
  // Method: compare offset Jan 1 and current date offset
  function isDST(tz, date) {
    const jan = new Date(date.getFullYear(), 0, 1);
    const jul = new Date(date.getFullYear(), 6, 1);

    const stdOffset = Math.max(
      getTimezoneOffsetMinutes(tz, jan),
      getTimezoneOffsetMinutes(tz, jul)
    );

    return getTimezoneOffsetMinutes(tz, date) < stdOffset;
  }

  // Add clock to the page
  function addClock(cityId) {
    if (currentClocks.includes(cityId)) {
      alert('This clock is already added.');
      return;
    }
    currentClocks.push(cityId);
    renderClocks();
  }

  // Remove clock (optional feature, can implement if wanted)
  // For now, no remove button provided

  // Render all clocks in the container
  function renderClocks() {
    clocksContainer.innerHTML = '';
    currentClocks.forEach(cityId => {
      const city = cities.find(c => c.id === cityId);
      if (city) {
        const clockEl = createClockElement(city);
        clocksContainer.appendChild(clockEl);
      }
    });
  }

  // Toggle night/day mode
  function toggleNightMode() {
    isNightMode = !isNightMode;
    if (isNightMode) {
      document.body.classList.add('night');
      toggleModeBtn.textContent = 'Switch to Day Mode';
    } else {
      document.body.classList.remove('night');
      toggleModeBtn.textContent = 'Switch to Night Mode';
    }
  }

  // Calculate time difference given city A's datetime, and city B
  function calculateTimeDifference(cityAId, cityBId, dateStr, timeStr) {
    if (!dateStr || !timeStr) {
      resultDiv.textContent = 'Please enter both date and time.';
      return;
    }

    const cityA = cities.find(c => c.id === cityAId);
    const cityB = cities.find(c => c.id === cityBId);
    if (!cityA || !cityB) {
      resultDiv.textContent = 'Invalid city selection.';
      return;
    }

    // Parse date and time from inputs
    const dtString = dateStr + 'T' + timeStr + ':00';
    // Parse this time as if it's in cityA timezone
    const cityADate = new Date(dtString);

    // Calculate cityA offset at given datetime
    const offsetA = getTimezoneOffsetMinutes(cityA.tz, cityADate);
    // Calculate UTC time from cityA local time
    const utcTime = new Date(cityADate.getTime() + offsetA * 60 * 1000);

    // Calculate cityB offset at the UTC time (converted to cityB local time)
    const offsetB = getTimezoneOffsetMinutes(cityB.tz, utcTime);

    // Calculate cityB local time
    const cityBDate = new Date(utcTime.getTime() - offsetB * 60 * 1000);

    // Calculate difference in hours and minutes between cityA and cityB at given time
    // Difference = offsetB - offsetA (in minutes)
    const diffMinutes = offsetB - offsetA;

    const diffSign = diffMinutes >= 0 ? '+' : '-';
    const diffH = Math.floor(Math.abs(diffMinutes) / 60);
    const diffM = Math.abs(diffMinutes) % 60;

    const formattedDiff = `${diffSign}${pad(diffH)}:${pad(diffM)}`;

    // Show results
    resultDiv.innerHTML = `
      <p><strong>${cityA.name}</strong> local time: ${formatDateTime(cityADate, cityA.tz)}</p>
      <p><strong>${cityB.name}</strong> local time: ${formatDateTime(cityBDate, cityB.tz)}</p>
      <p><strong>Time difference (City B - City A):</strong> ${formattedDiff} hours</p>
    `;
  }

  // Format date/time nicely for display with timezone info
  function formatDateTime(date, tz) {
    const options = {
      timeZone: tz,
      year: 'numeric', month: 'short', day: 'numeric',
      hour: '2-digit', minute: '2-digit', second: '2-digit',
      hour12: false,
      weekday: 'short'
    };
    return date.toLocaleString('en-US', options);
  }

  // Setup initial city selects and render clocks
  populateCitySelects();
  renderClocks();
  updateClocks();

  // Update clocks every second
  setInterval(updateClocks, 1000);

  // Event listeners
  addClockBtn.addEventListener('click', () => {
    const selectedCity = cityAddSelect.value;
    addClock(selectedCity);
  });

  toggleModeBtn.addEventListener('click', () => {
    toggleNightMode();
  });

  calcBtn.addEventListener('click', () => {
    const cityAId = calcCityA.value;
    const cityBId = calcCityB.value;
    const dateStr = calcDate.value;
    const timeStr = calcTime.value;
    calculateTimeDifference(cityAId, cityBId, dateStr, timeStr);
  });

  // Set default date input to today
  calcDate.value = new Date().toISOString().split('T')[0];
  // Set default time to current time in 24h format
  function setDefaultTime() {
    const now = new Date();
    const h = pad(now.getHours());
    const m = pad(now.getMinutes());
    calcTime.value = `${h}:${m}`;
  }
  setDefaultTime();

</script>

</body>
</html>
