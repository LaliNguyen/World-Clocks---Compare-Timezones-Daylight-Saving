<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>World Clocks - Compare Timezones & Daylight Saving</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; background: #f7f9fc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #222;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h1 {
    margin-bottom: 10px;
    font-weight: 700;
    color: #1a1a1a;
  }
  .clocks-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    max-width: 1100px;
    justify-content: center;
    margin-bottom: 40px;
  }
  .clock-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    padding: 24px 16px 32px;
    width: 280px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }
  .clock-header {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 10px;
    text-align: center;
  }
  canvas {
    background: #fff;
    border-radius: 50%;
    box-shadow: inset 0 0 12px #ddd;
    margin-bottom: 15px;
  }
  .digital-time {
    font-family: 'Courier New', monospace;
    font-size: 1.4rem;
    font-weight: 700;
    letter-spacing: 2px;
    margin-bottom: 8px;
  }
  .tz-info {
    font-size: 0.9rem;
    color: #555;
  }
  /* Add/remove controls */
  .controls {
    max-width: 1100px;
    width: 100%;
    margin-bottom: 30px;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    align-items: center;
  }
  select, button, input[type=date], input[type=time] {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1.5px solid #aaa;
    font-size: 1rem;
    outline-offset: 2px;
    transition: border-color 0.2s ease;
  }
  select:focus, button:focus, input[type=date]:focus, input[type=time]:focus {
    border-color: #3f51b5;
  }
  button {
    background: #3f51b5;
    color: white;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #303f9f;
  }
  button:disabled {
    background: #999;
    cursor: default;
  }
  /* Time difference calculator */
  .time-diff {
    max-width: 1100px;
    width: 100%;
    background: white;
    padding: 24px 20px;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  }
  .time-diff h2 {
    margin-top: 0;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 16px;
    text-align: center;
  }
  .time-diff-row {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
    margin-bottom: 20px;
  }
  .time-diff-row > * {
    flex: 1 1 180px;
    min-width: 150px;
  }
  .result {
    text-align: center;
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
  }
  /* Remove clock button */
  .remove-clock-btn {
    position: absolute;
    top: 10px;
    right: 12px;
    background: #e74c3c;
    border: none;
    color: white;
    font-weight: 700;
    border-radius: 50%;
    width: 26px;
    height: 26px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    line-height: 26px;
    text-align: center;
    transition: background 0.3s ease;
  }
  .remove-clock-btn:hover {
    background: #c0392b;
  }
</style>
</head>
<body>

<h1>World Clocks - Compare Timezones & Daylight Saving</h1>

<div class="controls">
  <select id="city-select" aria-label="Select city to add">
    <!-- Options populated by JS -->
  </select>
  <button id="add-clock-btn" aria-label="Add selected city clock">Add Clock</button>
</div>

<div class="clocks-wrapper" id="clocks-wrapper">
  <!-- Default clocks will be added by JS -->
</div>

<div class="time-diff">
  <h2>Time Difference Calculator</h2>
  <div class="time-diff-row">
    <select id="calc-city1" aria-label="First city">
      <!-- JS options -->
    </select>
    <select id="calc-city2" aria-label="Second city">
      <!-- JS options -->
    </select>
  </div>
  <div class="time-diff-row">
    <label>
      Date & Time in first city:<br/>
      <input type="date" id="calc-date" />
      <input type="time" id="calc-time" value="12:00" />
    </label>
  </div>
  <button id="calc-btn">Calculate Time Difference</button>
  <div class="result" id="calc-result"></div>
</div>

<script>
// Cities data: name, IANA timezone, country
const cities = [
  { id: 'america_new_york', name: 'New York, USA', tz: 'America/New_York' },
  { id: 'europe_london', name: 'London, UK', tz: 'Europe/London' },
  { id: 'asia_tokyo', name: 'Tokyo, Japan', tz: 'Asia/Tokyo' },
  { id: 'europe_berlin', name: 'Berlin, Germany', tz: 'Europe/Berlin' },
  { id: 'australia_sydney', name: 'Sydney, Australia', tz: 'Australia/Sydney' },
  { id: 'asia_mumbai', name: 'Mumbai, India', tz: 'Asia/Kolkata' },
  { id: 'america_los_angeles', name: 'Los Angeles, USA', tz: 'America/Los_Angeles' },
  { id: 'america_sao_paulo', name: 'SÃ£o Paulo, Brazil', tz: 'America/Sao_Paulo' },
  { id: 'africa_cairo', name: 'Cairo, Egypt', tz: 'Africa/Cairo' },
  { id: 'europe_paris', name: 'Paris, France', tz: 'Europe/Paris' },
];

// Utilities

function getTimeInTimeZone(date, timeZone) {
  return new Date(date.toLocaleString("en-US", {timeZone}));
}

// Get offset hours between UTC and a timezone at a specific date
function getOffsetHours(date, timeZone) {
  const utc = date.getTime() + date.getTimezoneOffset()*60000;
  const tzDate = new Date(date.toLocaleString("en-US", {timeZone}));
  return (tzDate.getTime() - utc) / 3600000;
}

// Check if daylight saving time is in effect for given date & timezone
function isDST(date, timeZone) {
  const jan = new Date(date.getFullYear(),0,1);
  const jul = new Date(date.getFullYear(),6,1);
  const stdOffset = Math.max(getOffsetHours(jan,timeZone), getOffsetHours(jul,timeZone));
  const currentOffset = getOffsetHours(date,timeZone);
  return currentOffset < stdOffset;
}

// Format date/time nicely with day name and offset info
function formatDateTime(date, timeZone) {
  const options = {
    timeZone,
    weekday: 'short',
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false,
    timeZoneName: 'short'
  };
  return date.toLocaleString('en-US', options);
}

// Draw analog clock
function drawAnalogClock(canvas, date, timeZone) {
  if (!canvas.getContext) return;
  const ctx = canvas.getContext('2d');
  const radius = canvas.height / 2;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.save();
  ctx.translate(radius, radius);

  // Clock face
  ctx.beginPath();
  ctx.arc(0, 0, radius - 5, 0, 2 * Math.PI);
  ctx.fillStyle = '#fff';
  ctx.shadowColor = 'rgba(0,0,0,0.1)';
  ctx.shadowBlur = 5;
  ctx.fill();
  ctx.lineWidth = 6;
  ctx.strokeStyle = '#444';
  ctx.stroke();

  // Draw hour marks + numbers
  ctx.font = radius * 0.15 + "px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
  ctx.fillStyle = '#333';
  ctx.textBaseline = "middle";
  ctx.textAlign = "center";

  for(let num = 1; num <= 12; num++){
    let ang = num * Math.PI / 6;
    ctx.rotate(ang);
    ctx.translate(0, -radius * 0.8);
    ctx.rotate(-ang);
    ctx.fillText(num.toString(), 0, 0);
    ctx.rotate(ang);
    ctx.translate(0, radius * 0.8);
    ctx.rotate(-ang);
  }

  // Get time in that timezone
  let localDate = getTimeInTimeZone(date, timeZone);

  let hour = localDate.getHours() % 12;
  let minute = localDate.getMinutes();
  let second = localDate.getSeconds();

  // Hour hand
  let hourAngle = ((hour + minute / 60) * Math.PI / 6);
  drawHand(ctx, hourAngle, radius * 0.5, 8);

  // Minute hand
  let minuteAngle = (minute * Math.PI / 30);
  drawHand(ctx, minuteAngle, radius * 0.75, 6);

  // Second hand
  let secondAngle = (second * Math.PI / 30);
  drawHand(ctx, secondAngle, radius * 0.85, 2, 'red');

  // Center dot
  ctx.beginPath();
  ctx.arc(0, 0, 7, 0, 2 * Math.PI);
  ctx.fillStyle = '#222';
  ctx.fill();

  ctx.restore();
}

function drawHand(ctx, pos, length, width, color='#222') {
  ctx.beginPath();
  ctx.lineWidth = width;
  ctx.lineCap = "round";
  ctx.strokeStyle = color;
  ctx.moveTo(0,0);
  ctx.rotate(pos);
  ctx.lineTo(0, -length);
  ctx.stroke();
  ctx.rotate(-pos);
}

// Format time HH:MM:SS
function formatDigitalTime(date, timeZone) {
  const opts = {hour12:false, hour:'2-digit', minute:'2-digit', second:'2-digit', timeZone};
  return date.toLocaleTimeString('en-GB', opts);
}

// --- Manage clocks UI & functionality ---

const clocksWrapper = document.getElementById('clocks-wrapper');
const citySelect = document.getElementById('city-select');
const addClockBtn = document.getElementById('add-clock-btn');

let activeClocks = new Map(); // key: city id, value: clock DOM

// Populate city select dropdown
function populateCitySelect(){
  citySelect.innerHTML = '';
  for (const city of cities) {
    // Skip if already added
    if(activeClocks.has(city.id)) continue;
    const option = document.createElement('option');
    option.value = city.id;
    option.textContent = city.name;
    citySelect.appendChild(option);
  }
  addClockBtn.disabled = citySelect.options.length === 0;
}

function createClockCard(city) {
  const card = document.createElement('div');
  card.className = 'clock-card';
  card.id = `clock-${city.id}`;

  // Remove button
  const removeBtn = document.createElement('button');
  removeBtn.className = 'remove-clock-btn';
  removeBtn.title = `Remove ${city.name}`;
  removeBtn.innerHTML = '&times;';
  removeBtn.onclick = () => {
    activeClocks.delete(city.id);
    clocksWrapper.removeChild(card);
    populateCitySelect();
  };
  card.appendChild(removeBtn);

  // Header
  const header = document.createElement('div');
  header.className = 'clock-header';
  header.textContent = city.name;
  card.appendChild(header);

  // Analog canvas
  const canvas = document.createElement('canvas');
  canvas.width = 200;
  canvas.height = 200;
  canvas.setAttribute('aria-label', `${city.name} analog clock`);
  card.appendChild(canvas);

  // Digital time
  const digital = document.createElement('div');
  digital.className = 'digital-time';
  digital.textContent = 'Loading...';
  card.appendChild(digital);

  // Timezone info
  const tzInfo = document.createElement('div');
  tzInfo.className = 'tz-info';
  tzInfo.textContent = '';
  card.appendChild(tzInfo);

  clocksWrapper.appendChild(card);

  activeClocks.set(city.id, { city, card, canvas, digital, tzInfo });
}

// Add default clocks (3 main)
function addDefaultClocks(){
  ['america_new_york', 'europe_london', 'asia_tokyo'].forEach(id => {
    const city = cities.find(c => c.id === id);
    if(city) createClockCard(city);
  });
  populateCitySelect();
}

// Update all clocks every second
function updateAllClocks() {
  const now = new Date();
  activeClocks.forEach(({city, canvas, digital, tzInfo}) => {
    // Analog clock draw
    drawAnalogClock(canvas, now, city.tz);

    // Digital clock update
    digital.textContent = formatDigitalTime(now, city.tz);

    // Timezone offset and DST
    const offset = getOffsetHours(now, city.tz);
    const dstActive = isDST(now, city.tz);
    const offsetSign = offset >= 0 ? '+' : '';
    tzInfo.textContent = `UTC${offsetSign}${offset.toFixed(1)} | DST: ${dstActive ? 'Yes' : 'No'}`;
  });
}

// Add new clock button
addClockBtn.addEventListener('click', () => {
  const cityId = citySelect.value;
  if(!cityId || activeClocks.has(cityId)) return;
  const city = cities.find(c => c.id === cityId);
  if(city) {
    createClockCard(city);
    populateCitySelect();
  }
});

// Time difference calculator
const calcCity1 = document.getElementById('calc-city1');
const calcCity2 = document.getElementById('calc-city2');
const calcDate = document.getElementById('calc-date');
const calcTime = document.getElementById('calc-time');
const calcBtn = document.getElementById('calc-btn');
const calcResult = document.getElementById('calc-result');

function populateCalcSelects(){
  calcCity1.innerHTML = '';
  calcCity2.innerHTML = '';
  for(const city of cities){
    const option1 = document.createElement('option');
    option1.value = city.id;
    option1.textContent = city.name;
    calcCity1.appendChild(option1);

    const option2 = document.createElement('option');
    option2.value = city.id;
    option2.textContent = city.name;
    calcCity2.appendChild(option2);
  }
  calcCity1.value = 'america_new_york';
  calcCity2.value = 'europe_london';

  // Default date: today, time: 12:00
  const today = new Date().toISOString().slice(0,10);
  calcDate.value = today;
  calcTime.value = '12:00';
}

function calculateTimeDifference(){
  const city1 = cities.find(c => c.id === calcCity1.value);
  const city2 = cities.find(c => c.id === calcCity2.value);
  if(!city1 || !city2){
    calcResult.textContent = 'Please select both cities.';
    return;
  }
  if(!calcDate.value || !calcTime.value){
    calcResult.textContent = 'Please select date and time.';
    return;
  }

  // Build Date object from input date & time in city1's timezone
  const localStr = `${calcDate.value}T${calcTime.value}:00`;
  // We create date in UTC first, then adjust it to city1 tz by subtracting offset
  let localDate = new Date(localStr + 'Z');

  // Get offset in hours for city1 tz at that date
  let offsetCity1 = getOffsetHours(localDate, city1.tz);
  // Convert localDate to UTC by subtracting offsetCity1
  let utcDate = new Date(localDate.getTime() - offsetCity1 * 3600000);

  // Now find local date in city2 at same UTC time
  let city2Date = getTimeInTimeZone(utcDate, city2.tz);

  // Calculate difference in hours
  let diffMs = city2Date.getTime() - getTimeInTimeZone(localDate, city1.tz).getTime();
  let diffH = diffMs / 3600000;

  // Format results
  const fmtDateCity1 = formatDateTime(localDate, city1.tz);
  const fmtDateCity2 = formatDateTime(city2Date, city2.tz);

  calcResult.innerHTML = `
    <p><strong>${city1.name}:</strong> ${fmtDateCity1}</p>
    <p><strong>${city2.name}:</strong> ${fmtDateCity2}</p>
    <p>Time difference: <strong>${diffH.toFixed(2)} hours</strong></p>
  `;
}

// Init
addDefaultClocks();
populateCalcSelects();
updateAllClocks();
setInterval(updateAllClocks, 1000);
calcBtn.addEventListener('click', calculateTimeDifference);
</script>
</body>
</html>
