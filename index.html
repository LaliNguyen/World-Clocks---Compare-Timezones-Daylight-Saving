<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="World Clock with analog and digital displays, timezone info, and time difference calculator." />
<title>World Clock & Time Difference Calculator</title>
<style>
  body {
    margin: 0; padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f9f9f9;
    color: #222;
  }
  h1, h2 {
    font-weight: 600;
    margin-bottom: 0.25em;
  }
  .container {
    max-width: 1000px;
    margin: auto;
  }
  .clocks {
    display: flex;
    gap: 24px;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 40px;
  }
  .clock {
    background: white;
    border: 3px solid #3a86ff;
    border-radius: 12px;
    width: 240px;
    padding: 16px;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
    text-align: center;
    transition: filter 0.5s ease, opacity 0.5s ease;
  }
  .clock.night {
    filter: brightness(0.6);
    opacity: 0.7;
  }
  .city-name {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 4px;
  }
  .tz-info {
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 12px;
  }
  .digital {
    font-family: monospace;
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    margin-bottom: 20px;
  }
  .analog-face {
    position: relative;
    width: 180px;
    height: 180px;
    margin: 0 auto;
    border: 4px solid #3a86ff;
    border-radius: 50%;
    background: white;
    box-sizing: border-box;
  }
  .analog-face .number {
    position: absolute;
    font-weight: 700;
    font-size: 1.2rem;
    color: #222;
    user-select: none;
  }
  .hand {
    position: absolute;
    bottom: 50%;
    left: 50%;
    border-radius: 3px;
    transform-origin: bottom center;
    transition: transform 0.3s ease-in-out;
  }
  .hand-hour {
    width: 6px;
    height: 45px;
    margin-left: -3px;
    background: #3a86ff;
  }
  .hand-minute {
    width: 4px;
    height: 65px;
    margin-left: -2px;
    background: #1e6091;
  }
  .hand-second {
    width: 2px;
    height: 75px;
    margin-left: -1px;
    background: #ff4d6d;
  }
  .center-dot {
    position: absolute;
    width: 12px;
    height: 12px;
    background: #222;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    margin-top: -6px;
    margin-left: -6px;
    z-index: 10;
  }
  .controls {
    max-width: 600px;
    margin: 0 auto;
  }
  label {
    display: block;
    margin: 1em 0 0.25em;
    font-weight: 600;
  }
  select, input[type=date], input[type=time] {
    width: 100%;
    padding: 0.35em 0.5em;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
  }
  button {
    margin-top: 1.5em;
    padding: 0.6em 1.2em;
    font-size: 1rem;
    font-weight: 700;
    color: white;
    background-color: #3a86ff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    user-select: none;
  }
  button:hover {
    background-color: #265fbf;
  }
  .result {
    margin-top: 1.5em;
    font-weight: 600;
    font-size: 1.1rem;
    color: #111;
  }
  @media (max-width: 650px) {
    .clocks {
      flex-direction: column;
      align-items: center;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>World Clock & Time Difference Calculator</h1>

    <section class="clocks" id="clocks"></section>

    <section class="controls" aria-label="Time difference calculator">
      <h2>Calculate Time Difference</h2>

      <label for="calcCityA">City A:</label>
      <select id="calcCityA"></select>

      <label for="calcCityB">City B:</label>
      <select id="calcCityB"></select>

      <label for="calcDate">Date:</label>
      <input type="date" id="calcDate" />

      <label for="calcTime">Time:</label>
      <input type="time" id="calcTime" step="60" />

      <button id="calcButton">Calculate Difference</button>

      <div class="result" id="calcResult" aria-live="polite" aria-atomic="true"></div>
    </section>
  </div>

<script>
  const cities = [
    { id: 'america_new_york', name: 'New York', tz: 'America/New_York' },
    { id: 'europe_london', name: 'London', tz: 'Europe/London' },
    { id: 'asia_tokyo', name: 'Tokyo', tz: 'Asia/Tokyo' },
    { id: 'australia_sydney', name: 'Sydney', tz: 'Australia/Sydney' },
    { id: 'europe_berlin', name: 'Berlin', tz: 'Europe/Berlin' },
    { id: 'america_los_angeles', name: 'Los Angeles', tz: 'America/Los_Angeles' },
    { id: 'america_chicago', name: 'Chicago', tz: 'America/Chicago' },
    { id: 'asia_shanghai', name: 'Shanghai', tz: 'Asia/Shanghai' }
  ];

  let currentClocks = [
    { id: 'america_new_york', city: cities.find(c=>c.id==='america_new_york') },
    { id: 'europe_london', city: cities.find(c=>c.id==='europe_london') },
    { id: 'asia_tokyo', city: cities.find(c=>c.id==='asia_tokyo') }
  ];

  const clocksContainer = document.getElementById('clocks');

  function createClockElem(city) {
    const clock = document.createElement('article');
    clock.className = 'clock';
    clock.setAttribute('aria-label', `Clock for ${city.name} timezone`);

    const cityName = document.createElement('div');
    cityName.className = 'city-name';
    cityName.textContent = city.name;
    clock.appendChild(cityName);

    const tzInfo = document.createElement('div');
    tzInfo.className = 'tz-info';
    tzInfo.textContent = city.tz.replace('_', ' ').replace(/\/+/g, ', ');
    clock.appendChild(tzInfo);

    const digital = document.createElement('div');
    digital.className = 'digital';
    digital.textContent = '00:00:00';
    clock.appendChild(digital);

    const analog = document.createElement('div');
    analog.className = 'analog-face';
    clock.appendChild(analog);

    for(let n=1; n<=12; n++) {
      const num = document.createElement('div');
      num.className = 'number';
      num.textContent = n;
      const angle = (n * 30) - 90; // start at top
      const radius = 75;
      const rad = angle * Math.PI / 180;
      const x = 90 + Math.cos(rad) * radius - 10;
      const y = 90 + Math.sin(rad) * radius - 14;
      num.style.left = `${x}px`;
      num.style.top = `${y}px`;
      analog.appendChild(num);
    }

    const hourHand = document.createElement('div');
    hourHand.className = 'hand hand-hour';
    analog.appendChild(hourHand);

    const minuteHand = document.createElement('div');
    minuteHand.className = 'hand hand-minute';
    analog.appendChild(minuteHand);

    const secondHand = document.createElement('div');
    secondHand.className = 'hand hand-second';
    analog.appendChild(secondHand);

    const centerDot = document.createElement('div');
    centerDot.className = 'center-dot';
    analog.appendChild(centerDot);

    return { clock, digital, hourHand, minuteHand, secondHand };
  }

  function updateClocks() {
    const now = new Date();
    currentClocks.forEach(({ clock, digital, hourHand, minuteHand, secondHand, city }) => {
      const nowCity = new Date(now.toLocaleString('en-US', { timeZone: city.tz }));

      // Digital HH:mm:ss
      digital.textContent = nowCity.toLocaleTimeString('en-GB', { hour12: false });

      // Calculate angles
      const h = nowCity.getHours() % 12;
      const m = nowCity.getMinutes();
      const s = nowCity.getSeconds();

      const hourAngle = (h * 30) + (m * 0.5);
      const minuteAngle = (m * 6) + (s * 0.1);
      const secondAngle = s * 6;

      hourHand.style.transform = `rotate(${hourAngle}deg)`;
      minuteHand.style.transform = `rotate(${minuteAngle}deg)`;
      secondHand.style.transform = `rotate(${secondAngle}deg)`;

      // Night dimming (20:00-06:00 local time)
      if (nowCity.getHours() >= 20 || nowCity.getHours() < 6) {
        clock.classList.add('night');
      } else {
        clock.classList.remove('night');
      }
    });
  }

  // Initialize clocks
  currentClocks = currentClocks.map(({ id, city }) => {
    const { clock, digital, hourHand, minuteHand, secondHand } = createClockElem(city);
    clocksContainer.appendChild(clock);
    return { id, city, clock, digital, hourHand, minuteHand, secondHand };
  });

  // Update every second
  updateClocks();
  setInterval(updateClocks, 1000);

  // Populate dropdowns for calculator
  const calcCityA = document.getElementById('calcCityA');
  const calcCityB = document.getElementById('calcCityB');

  cities.forEach(city => {
    const optionA = document.createElement('option');
    optionA.value = city.id;
    optionA.textContent = city.name;
    calcCityA.appendChild(optionA);

    const optionB = document.createElement('option');
    optionB.value = city.id;
    optionB.textContent = city.name;
    calcCityB.appendChild(optionB);
  });

  // Set default calculator values
  const calcDate = document.getElementById('calcDate');
  const calcTime = document.getElementById('calcTime');
  const nowISO = new Date().toISOString();
  calcDate.value = nowISO.slice(0,10);
  calcTime.value = nowISO.slice(11,16);

  calcCityA.value = 'america_new_york';
  calcCityB.value = 'asia_tokyo';

  const calcResult = document.getElementById('calcResult');
  const calcButton = document.getElementById('calcButton');

  calcButton.addEventListener('click', () => {
    const cityA = cities.find(c => c.id === calcCityA.value);
    const cityB = cities.find(c => c.id === calcCityB.value);

    if (!cityA || !cityB) {
      calcResult.textContent = 'Please select both cities.';
      return;
    }
    if (!calcDate.value || !calcTime.value) {
      calcResult.textContent = 'Please select a valid date and time.';
      return;
    }

    // Construct date/time in city A's timezone as Date object (approximate)
    // Because JS Date does not parse time zones directly, use UTC with offsets.

    // First parse input date & time as local date/time (not utc)
    const dateTimeStr = `${calcDate.value}T${calcTime.value}:00`;

    // Create a date in city A's tz: trick is to parse in UTC and then shift by timezone offset.

    // Get offset in minutes for city A at that date/time
    function getOffsetMinutes(timeZone, date) {
      const dtf = new Intl.DateTimeFormat('en-US', {
        timeZone,
        hour12: false,
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      const [{ value: mo }, , { value: da }, , { value: ye }, , { value: ho }, , { value: mi }, , { value: se }] = dtf.formatToParts(date);
      // Build date string in UTC format for parsed parts
      const asUTC = Date.UTC(+ye, mo-1, +da, +ho, +mi, +se);
      // Offset in minutes between given date UTC and local date/time in timezone:
      return (date.getTime() - asUTC) / 60000;
    }

    // Parse dateTimeStr as if local = city A's local time => create a date with same numbers but in UTC
    const localDateA = new Date(dateTimeStr + 'Z'); // parse as UTC
    // Calculate offset for city A at this time
    const offsetA = getOffsetMinutes(cityA.tz, localDateA);
    // Shift date by offsetA minutes to get city A local time in UTC terms
    const cityALocalTime = new Date(localDateA.getTime() - offsetA * 60000);

    // Now calculate what time this corresponds to in city B timezone by adding difference offsets
    const offsetB = getOffsetMinutes(cityB.tz, cityALocalTime);
    const cityBLocal = new Date(cityALocalTime.getTime() + offsetB * 60000);

    // Calculate difference in ms
    let diffMs = cityBLocal.getTime() - localDateA.getTime();

    const diffSign = diffMs >= 0 ? '+' : '-';
    diffMs = Math.abs(diffMs);

    const diffHrs = Math.floor(diffMs / (1000 * 60 * 60));
    const diffMins = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));

    calcResult.textContent = `Time in ${cityB.name} corresponding to ${calcDate.value} ${calcTime.value} in ${cityA.name} is: ` +
      cityBLocal.toLocaleString('en-GB', { timeZone: cityB.tz, hour12: false }) + 
      ` (UTC${diffSign}${diffHrs}h ${diffMins}m difference)`;
  });
</script>

</body>
</html>
