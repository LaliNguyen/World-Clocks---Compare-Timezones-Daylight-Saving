<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="World Clock - Digital and Analog clocks for multiple cities with draggable layout and dark mode." />
<title>World Clock | LulssuLabs</title>
<style>
  :root {
    --bg-light: #f5f7fa;
    --bg-dark: #121212;
    --card-light: #fff;
    --card-dark: #1e1e1e;
    --text-light: #222;
    --text-dark: #eee;
    --accent: #0077ff;
    --shadow-light: rgba(0, 0, 0, 0.1);
    --shadow-dark: rgba(0, 0, 0, 0.7);
  }
  body {
    margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-light);
    color: var(--text-light);
    transition: background 0.3s, color 0.3s;
    min-height: 100vh;
    display: flex; flex-direction: column;
  }
  body.dark {
    background: var(--bg-dark);
    color: var(--text-dark);
  }
  header {
    padding: 1rem 2rem;
    font-size: 1.5rem;
    font-weight: 700;
    text-align: center;
    background: var(--accent);
    color: #fff;
    user-select: none;
  }
  main {
    flex-grow: 1;
    padding: 2rem;
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: center;
    min-height: 60vh;
  }
  .clock-card {
    background: var(--card-light);
    box-shadow: 0 4px 12px var(--shadow-light);
    border-radius: 16px;
    width: 280px;
    padding: 1.5rem 1rem 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: grab;
    user-select: none;
    transition: background 0.3s, box-shadow 0.3s;
    position: relative;
  }
  body.dark .clock-card {
    background: var(--card-dark);
    box-shadow: 0 4px 12px var(--shadow-dark);
  }
  .clock-card:active {
    cursor: grabbing;
  }
  .city-name {
    font-weight: 700;
    font-size: 1.3rem;
    margin-bottom: 0.4rem;
  }
  .digital-clock {
    font-size: 2.8rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    margin-bottom: 1rem;
    font-family: 'Courier New', Courier, monospace;
  }
  .analog-clock {
    position: relative;
    width: 150px;
    height: 150px;
    border: 6px solid var(--accent);
    border-radius: 50%;
    background: var(--bg-light);
    box-shadow: inset 0 0 8px rgba(0,0,0,0.1);
    margin-bottom: 1rem;
  }
  body.dark .analog-clock {
    background: #222;
  }
  .analog-clock .number {
    position: absolute;
    font-weight: 600;
    font-size: 1rem;
    color: var(--accent);
    user-select: none;
  }
  /* Position numbers 1 to 12 around clock */
  .number1  { top: 10px; left: 50%; transform: translateX(-50%); }
  .number2  { top: 28px; right: 20px; }
  .number3  { top: 50%; right: 10px; transform: translateY(-50%); }
  .number4  { bottom: 28px; right: 20px; }
  .number5  { bottom: 10px; right: 50px; }
  .number6  { bottom: 10px; left: 50%; transform: translateX(-50%); }
  .number7  { bottom: 10px; left: 50px; }
  .number8  { bottom: 28px; left: 20px; }
  .number9  { top: 50%; left: 10px; transform: translateY(-50%); }
  .number10 { top: 28px; left: 20px; }
  .number11 { top: 10px; left: 50px; }
  .number12 { top: 5px; left: 50%; transform: translateX(-50%); }
  .hand {
    position: absolute;
    bottom: 50%;
    left: 50%;
    background: var(--accent);
    border-radius: 2px;
    transform-origin: bottom center;
    transition: transform 0.1s linear;
  }
  .hour {
    width: 6px;
    height: 40px;
  }
  .minute {
    width: 4px;
    height: 60px;
  }
  .second {
    width: 2px;
    height: 70px;
    background: red;
  }
  .controls {
    display: flex;
    gap: 0.5rem;
    margin-top: auto;
    flex-wrap: wrap;
    justify-content: center;
  }
  button {
    background: var(--accent);
    border: none;
    border-radius: 8px;
    padding: 0.4rem 1rem;
    color: white;
    font-weight: 600;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s;
  }
  button:hover {
    background: #005bb5;
  }
  button.remove-clock {
    background: #e74c3c;
  }
  button.remove-clock:hover {
    background: #c0392b;
  }
  .toggle-mode {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: var(--accent);
    border: none;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 4px 8px var(--shadow-light);
    z-index: 1000;
    transition: background 0.3s;
  }
  body.dark .toggle-mode {
    box-shadow: 0 4px 8px var(--shadow-dark);
  }
  .toggle-mode:hover {
    background: #005bb5;
  }
  footer {
    padding: 1rem;
    text-align: center;
    font-size: 0.9rem;
    color: var(--accent);
    user-select: none;
  }
  .add-clock-form {
    width: 280px;
    margin: 0 auto 2rem;
    display: flex;
    gap: 0.5rem;
    justify-content: center;
  }
  .add-clock-form input {
    flex-grow: 1;
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }
  .add-clock-form button {
    flex-shrink: 0;
  }
</style>
</head>
<body>

<header>World Clock - LulssuLabs</header>

<button aria-label="Toggle light/dark mode" id="toggleTheme" class="toggle-mode" title="Toggle Light/Dark Mode">🌓</button>

<main id="clockContainer">
  <!-- Clock cards will be inserted here -->
</main>

<form id="addClockForm" class="add-clock-form" aria-label="Add new clock by city name">
  <input type="text" id="newCity" placeholder="Add city (e.g. Paris)" aria-label="City name" required />
  <button type="submit" aria-label="Add clock">Add</button>
</form>

<footer>© 2025 LulssuLabs</footer>

<script>
(() => {
  const defaultCities = [
    { name: 'New York', tz: 'America/New_York' },
    { name: 'London', tz: 'Europe/London' },
    { name: 'Tokyo', tz: 'Asia/Tokyo' }
  ];

  const clockContainer = document.getElementById('clockContainer');
  const addClockForm = document.getElementById('addClockForm');
  const newCityInput = document.getElementById('newCity');
  const toggleThemeBtn = document.getElementById('toggleTheme');

  // State of clocks: {id, name, tz, mode: 'digital'|'analog'}
  let clocks = [];

  // Save and load clocks from localStorage
  function saveClocks() {
    localStorage.setItem('worldClocks', JSON.stringify(clocks));
  }
  function loadClocks() {
    const saved = localStorage.getItem('worldClocks');
    if (saved) {
      clocks = JSON.parse(saved);
    } else {
      clocks = defaultCities.map(c => ({ ...c, mode: 'digital', id: crypto.randomUUID() }));
    }
  }

  // Light/Dark mode
  function setTheme(dark) {
    if (dark) {
      document.body.classList.add('dark');
      toggleThemeBtn.textContent = '☀️';
      localStorage.setItem('theme', 'dark');
    } else {
      document.body.classList.remove('dark');
      toggleThemeBtn.textContent = '🌓';
      localStorage.setItem('theme', 'light');
    }
  }
  // Load theme on start
  const savedTheme = localStorage.getItem('theme');
  setTheme(savedTheme === 'dark');

  toggleThemeBtn.addEventListener('click', () => {
    setTheme(!document.body.classList.contains('dark'));
  });

  // Clock rendering
  function createClockCard(clock) {
    const card = document.createElement('section');
    card.className = 'clock-card';
    card.setAttribute('draggable', 'true');
    card.dataset.id = clock.id;

    // City name
    const cityName = document.createElement('h2');
    cityName.className = 'city-name';
    cityName.textContent = clock.name;
    card.appendChild(cityName);

    // Clock display container
    const display = document.createElement('div');
    display.className = 'clock-display';
    card.appendChild(display);

    // Digital clock element
    const digital = document.createElement('div');
    digital.className = 'digital-clock';
    display.appendChild(digital);

    // Analog clock element
    const analog = document.createElement('div');
    analog.className = 'analog-clock';
    // Add numbers 1-12 around clock
    for(let i=1; i<=12; i++) {
      const number = document.createElement('div');
      number.className = `number number${i}`;
      number.textContent = i;
      analog.appendChild(number);
    }
    // Add hands
    ['hour', 'minute', 'second'].forEach(handName => {
      const hand = document.createElement('div');
      hand.className = `hand ${handName}`;
      analog.appendChild(hand);
    });
    display.appendChild(analog);

    // Controls: toggle analog/digital and remove
    const controls = document.createElement('div');
    controls.className = 'controls';

    const toggleBtn = document.createElement('button');
    toggleBtn.textContent = clock.mode === 'digital' ? 'Show Analog' : 'Show Digital';
    toggleBtn.setAttribute('aria-label', 'Toggle clock display mode');
    toggleBtn.addEventListener('click', () => {
      clock.mode = clock.mode === 'digital' ? 'analog' : 'digital';
      saveClocks();
      renderClocks();
    });
    controls.appendChild(toggleBtn);

    const removeBtn = document.createElement('button');
    removeBtn.textContent = 'Remove';
    removeBtn.className = 'remove-clock';
    removeBtn.setAttribute('aria-label', `Remove clock for ${clock.name}`);
    removeBtn.addEventListener('click', () => {
      clocks = clocks.filter(c => c.id !== clock.id);
      saveClocks();
      renderClocks();
    });
    controls.appendChild(removeBtn);

    card.appendChild(controls);

    // Show only selected mode
    digital.style.display = clock.mode === 'digital' ? 'block' : 'none';
    analog.style.display = clock.mode === 'analog' ? 'block' : 'none';

    // Drag and Drop handlers
    card.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', clock.id);
      card.style.opacity = '0.5';
    });
    card.addEventListener('dragend', () => {
      card.style.opacity = '';
    });

    return card;
  }

  // Update clock times
  function updateTimes() {
    clocks.forEach(clock => {
      const card = clockContainer.querySelector(`[data-id="${clock.id}"]`);
      if (!card) return;

      const now = new Date();
      const options = { timeZone: clock.tz, hour12: false };
      const timeStr = now.toLocaleTimeString('en-GB', options); // 24h format HH:mm:ss

      const digital = card.querySelector('.digital-clock');
      if (digital) digital.textContent = timeStr;

      const analog = card.querySelector('.analog-clock');
      if (analog) {
        const hands = {
          hour: analog.querySelector('.hand.hour'),
          minute: analog.querySelector('.hand.minute'),
          second: analog.querySelector('.hand.second')
        };

        // Get time parts in that timezone
        const tzTime = new Date(now.toLocaleString('en-US', { timeZone: clock.tz }));
        let h = tzTime.getHours() % 12;
        let m = tzTime.getMinutes();
        let s = tzTime.getSeconds();

        // Calculate degrees
        const hourDeg = (h + m / 60) * 30; // 360/12 = 30
        const minDeg = (m + s / 60) * 6;   // 360/60 = 6
        const secDeg = s * 6;

        if (hands.hour) hands.hour.style.transform = `rotate(${hourDeg}deg)`;
        if (hands.minute) hands.minute.style.transform = `rotate(${minDeg}deg)`;
        if (hands.second) hands.second.style.transform = `rotate(${secDeg}deg)`;
      }
    });
  }

  // Render all clocks
  function renderClocks() {
    clockContainer.innerHTML = '';
    clocks.forEach(clock => {
      const card = createClockCard(clock);
      clockContainer.appendChild(card);
    });
    updateTimes();
  }

  // Add new clock by city
  addClockForm.addEventListener('submit', e => {
    e.preventDefault();
    const city = newCityInput.value.trim();
    if (!city) return;

    // Attempt to get time zone from Intl API
    // Unfortunately, no direct way to get tz by city name,
    // so we fallback to manual mapping or a basic guess:
    // For demonstration: allow adding only well-known IANA tz strings or cities in the defaultCities
    // Or treat input as a city and try to find matching tz from Intl.supportedValuesOf('timeZone')

    // Validate timezone or fallback
    const possibleTimeZones = Intl.supportedValuesOf('timeZone');
    const matchedTZ = possibleTimeZones.find(tz => tz.toLowerCase().includes(city.toLowerCase()));

    if (!matchedTZ) {
      alert('City/timezone not found. Try a major city or correct timezone string like "Europe/Paris".');
      return;
    }

    clocks.push({ id: crypto.randomUUID(), name: city, tz: matchedTZ, mode: 'digital' });
    saveClocks();
    renderClocks();
    addClockForm.reset();
  });

  // Drag and drop sorting
  let draggedId = null;
  clockContainer.addEventListener('dragover', e => {
    e.preventDefault();
    const afterElement = getDragAfterElement(clockContainer, e.clientX, e.clientY);
    const draggingEl = clockContainer.querySelector(`[data-id="${draggedId}"]`);
    if (!draggingEl) return;

    if (afterElement == null) {
      clockContainer.appendChild(draggingEl);
    } else {
      clockContainer.insertBefore(draggingEl, afterElement);
    }
  });
  clockContainer.addEventListener('dragstart', e => {
    draggedId = e.target.dataset.id;
  });
  clockContainer.addEventListener('drop', e => {
    e.preventDefault();
    // Update clocks array order according to DOM
    const newOrder = Array.from(clockContainer.children).map(c => c.dataset.id);
    clocks.sort((a, b) => newOrder.indexOf(a.id) - newOrder.indexOf(b.id));
    saveClocks();
    draggedId = null;
  });

  function getDragAfterElement(container, x, y) {
    const draggableElements = [...container.querySelectorAll('.clock-card:not(.dragging)')];

    return draggableElements.reduce((closest, child) => {
      const box = child.getBoundingClientRect();
      const offset = y - box.top - box.height / 2;
      if (offset < 0 && offset > closest.offset) {
        return { offset: offset, element: child };
      } else {
        return closest;
      }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
  }

  // Initialize
  loadClocks();
  renderClocks();
  setInterval(updateTimes, 1000);
})();
</script>

</body>
</html>
