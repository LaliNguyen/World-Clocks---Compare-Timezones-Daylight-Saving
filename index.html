<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>World Clock - Compare Timezones, Daylight Saving & Time Differences</title>
<style>
  /* Reset & base */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 20px; background: #f0f2f5;
    color: #222;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    font-weight: 700;
  }
  .clocks-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }
  .clock-card {
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 8px 16px rgb(0 0 0 / 0.12);
    padding: 20px;
    width: 280px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }
  .city-select {
    margin-bottom: 12px;
    width: 100%;
  }
  select {
    width: 100%;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
    outline-offset: 2px;
  }
  .remove-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #f44336;
    border: none;
    border-radius: 50%;
    width: 26px; height: 26px;
    color: white;
    font-weight: 700;
    cursor: pointer;
  }
  .time-info {
    margin-top: 8px;
    font-size: 14px;
    text-align: center;
  }
  /* Analog clock styles */
  .analog-clock {
    position: relative;
    width: 180px;
    height: 180px;
    border: 6px solid #4a90e2;
    border-radius: 50%;
    background: white;
    box-shadow: inset 0 0 10px #cdd6e4;
  }
  .clock-center {
    position: absolute;
    top: 50%; left: 50%;
    width: 14px; height: 14px;
    margin-left: -7px;
    margin-top: -7px;
    background: #4a90e2;
    border-radius: 50%;
    z-index: 10;
  }
  .hand {
    position: absolute;
    top: 50%;
    left: 50%;
    transform-origin: bottom center;
    background: #4a90e2;
    border-radius: 6px;
  }
  .hand.hour {
    width: 8px;
    height: 50px;
    margin-left: -4px;
    margin-top: -50px;
    z-index: 7;
  }
  .hand.minute {
    width: 5px;
    height: 70px;
    margin-left: -2.5px;
    margin-top: -70px;
    z-index: 8;
  }
  .hand.second {
    width: 2px;
    height: 80px;
    margin-left: -1px;
    margin-top: -80px;
    background: #e74c3c;
    z-index: 9;
  }
  /* Numbers on clock */
  .clock-number {
    position: absolute;
    width: 22px;
    height: 22px;
    text-align: center;
    font-weight: 600;
    color: #4a90e2;
    user-select: none;
  }
  /* Positions for numbers */
  .num1  { top: 20px; left: 50%; transform: translateX(-50%); }
  .num2  { top: 40px; right: 30px; }
  .num3  { top: 90px; right: 12px; }
  .num4  { bottom: 40px; right: 30px; }
  .num5  { bottom: 20px; right: 70px; }
  .num6  { bottom: 12px; left: 50%; transform: translateX(-50%); }
  .num7  { bottom: 20px; left: 70px; }
  .num8  { bottom: 40px; left: 30px; }
  .num9  { top: 90px; left: 12px; }
  .num10 { top: 40px; left: 30px; }
  .num11 { top: 20px; left: 70px; }
  .num12 { top: 12px; left: 50%; transform: translateX(-50%); font-weight: 700; }
  
  /* Digital time */
  .digital-time {
    margin-top: 10px;
    font-size: 20px;
    font-weight: 700;
    color: #333;
  }
  /* Add Clock Button */
  #addClockBtn {
    margin: 30px auto 10px;
    display: block;
    background: #4a90e2;
    border: none;
    color: white;
    font-weight: 700;
    padding: 12px 20px;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 5px 12px rgb(74 144 226 / 0.5);
    transition: background 0.3s ease;
  }
  #addClockBtn:hover {
    background: #357ABD;
  }
  /* Time difference calculator */
  .time-calculator {
    background: white;
    max-width: 700px;
    margin: 40px auto 0;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 8px 16px rgb(0 0 0 / 0.12);
  }
  .time-calculator h2 {
    margin-top: 0;
    font-weight: 700;
    text-align: center;
    color: #4a90e2;
  }
  .calc-row {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .calc-row > * {
    flex: 1 1 150px;
    max-width: 250px;
  }
  input[type="datetime-local"],
  select {
    width: 100%;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
  .calc-result {
    margin-top: 20px;
    font-size: 16px;
    text-align: center;
    color: #222;
  }
  @media (max-width: 700px) {
    .clocks-container {
      flex-direction: column;
      align-items: center;
    }
    .calc-row {
      flex-direction: column;
      align-items: center;
    }
  }
</style>
</head>
<body>

<h1>World Clock - Compare Timezones, Daylight Saving & Time Differences</h1>

<div class="clocks-container" id="clocksContainer">
  <!-- Clock cards inserted here by JS -->
</div>

<button id="addClockBtn">Add Clock</button>

<section class="time-calculator">
  <h2>Time Difference Calculator</h2>
  <div class="calc-row">
    <div>
      <label for="baseCity">From City:</label>
      <select id="baseCity"></select>
    </div>
    <div>
      <label for="baseDateTime">Date & Time:</label>
      <input type="datetime-local" id="baseDateTime" />
    </div>
    <div>
      <label for="targetCity">To City:</label>
      <select id="targetCity"></select>
    </div>
  </div>
  <div class="calc-result" id="calcResult">Select cities and date/time to compare</div>
</section>

<script>
  // List of some common cities with timezones (you can expand)
  const cityList = [
    { city: "New York", country: "USA", tz: "America/New_York" },
    { city: "London", country: "UK", tz: "Europe/London" },
    { city: "Tokyo", country: "Japan", tz: "Asia/Tokyo" },
    { city: "Paris", country: "France", tz: "Europe/Paris" },
    { city: "Sydney", country: "Australia", tz: "Australia/Sydney" },
    { city: "Moscow", country: "Russia", tz: "Europe/Moscow" },
    { city: "Dubai", country: "UAE", tz: "Asia/Dubai" },
    { city: "Los Angeles", country: "USA", tz: "America/Los_Angeles" },
    { city: "Beijing", country: "China", tz: "Asia/Shanghai" },
    { city: "Berlin", country: "Germany", tz: "Europe/Berlin" }
  ];

  const clocksContainer = document.getElementById("clocksContainer");
  const addClockBtn = document.getElementById("addClockBtn");

  // Fill city selects for calculator
  const baseCitySelect = document.getElementById("baseCity");
  const targetCitySelect = document.getElementById("targetCity");
  cityList.forEach(({ city, country }) => {
    const option1 = document.createElement("option");
    option1.value = city;
    option1.textContent = `${city}, ${country}`;
    baseCitySelect.appendChild(option1);

    const option2 = document.createElement("option");
    option2.value = city;
    option2.textContent = `${city}, ${country}`;
    targetCitySelect.appendChild(option2);
  });

  // Default clocks to show initially
  let clocks = [
    { id: 1, city: "New York" },
    { id: 2, city: "London" },
    { id: 3, city: "Tokyo" }
  ];

  function createAnalogClockHands() {
    return `
      <div class="clock-center"></div>
      <div class="hand hour" style="transform: rotate(0deg)"></div>
      <div class="hand minute" style="transform: rotate(0deg)"></div>
      <div class="hand second" style="transform: rotate(0deg)"></div>
      ${[1,2,3,4,5,6,7,8,9,10,11,12].map(num => `<div class="clock-number num${num}">${num}</div>`).join('')}
    `;
  }

  // Create clock card HTML
  function createClockCard(clock) {
    return `
      <div class="clock-card" data-id="${clock.id}">
        <button class="remove-btn" title="Remove clock">&times;</button>
        <select class="city-select" aria-label="Select city for clock">
          ${cityList.map(({city, country}) =>
            `<option value="${city}" ${city === clock.city ? 'selected' : ''}>${city}, ${country}</option>`
          ).join('')}
        </select>
        <div class="analog-clock">
          ${createAnalogClockHands()}
        </div>
        <div class="digital-time" aria-live="polite"></div>
        <div class="time-info"></div>
      </div>
    `;
  }

  // Render all clocks to DOM
  function renderClocks() {
    clocksContainer.innerHTML = clocks.map(createClockCard).join('');
    attachEventListeners();
  }

  // Update clocks times every second
  function updateClocks() {
    const now = new Date();
    clocks.forEach(clock => {
      const card = document.querySelector(`.clock-card[data-id="${clock.id}"]`);
      if (!card) return;
      const citySelect = card.querySelector(".city-select");
      const cityName = citySelect.value;
      const cityData = cityList.find(c => c.city === cityName);
      if (!cityData) return;

      // Calculate time in city timezone
      const timeInZone = new Date(now.toLocaleString("en-US", { timeZone: cityData.tz }));
      // Extract hours, minutes, seconds
      const h = timeInZone.getHours();
      const m = timeInZone.getMinutes();
      const s = timeInZone.getSeconds();

      // Calculate hand angles
      const hourAngle = (h % 12) * 30 + (m / 60) * 30;
      const minuteAngle = m * 6 + (s / 60) * 6;
      const secondAngle = s * 6;

      // Update analog hands
      const hourHand = card.querySelector(".hand.hour");
      const minuteHand = card.querySelector(".hand.minute");
      const secondHand = card.querySelector(".hand.second");

      hourHand.style.transform = `rotate(${hourAngle}deg)`;
      minuteHand.style.transform = `rotate(${minuteAngle}deg)`;
      secondHand.style.transform = `rotate(${secondAngle}deg)`;

      // Update digital time (HH:MM:SS)
      const digital = card.querySelector(".digital-time");
      digital.textContent = timeInZone.toLocaleTimeString([], { hour12: false });

      // Timezone abbreviation & DST info
      const isDST = isDaylightSaving(timeInZone, cityData.tz);
      const tzAbbr = getTimezoneAbbr(timeInZone, cityData.tz);
      const timeInfo = card.querySelector(".time-info");
      timeInfo.textContent = `${tzAbbr} ${isDST ? '(DST)' : '(Standard Time)'}`;
    });
  }

  // Check if date is in daylight saving time in a timezone
  function isDaylightSaving(date, tz) {
    // Compare offsets of Jan 1 and July 1 to guess DST in tz
    const jan = new Date(date.getFullYear(), 0, 1).toLocaleString("en-US", { timeZone: tz });
    const jul = new Date(date.getFullYear(), 6, 1).toLocaleString("en-US", { timeZone: tz });
    const janOffset = new Date(jan).getTimezoneOffset();
    const julOffset = new Date(jul).getTimezoneOffset();
    const currentOffset = date.getTimezoneOffset();
    // If current offset is different from max offset, then DST active
    return currentOffset < Math.max(janOffset, julOffset);
  }

  // Get timezone abbreviation for a date and tz
  function getTimezoneAbbr(date, tz) {
    try {
      // Use Intl.DateTimeFormat with short timeZoneName
      return new Intl.DateTimeFormat('en-US', {
        timeZone: tz,
        timeZoneName: 'short'
      }).formatToParts(date).find(part => part.type === 'timeZoneName').value;
    } catch {
      return tz;
    }
  }

  // Add clock
  function addClock(city) {
    const newId = clocks.length ? Math.max(...clocks.map(c => c.id)) + 1 : 1;
    clocks.push({ id: newId, city: city || cityList[0].city });
    renderClocks();
  }

  // Remove clock
  function removeClock(id) {
    if (clocks.length === 1) {
      alert("At least one clock must be shown.");
      return;
    }
    clocks = clocks.filter(c => c.id !== id);
    renderClocks();
  }

  // Handle city select change
  function onCityChange(id, city) {
    const clock = clocks.find(c => c.id === id);
    if (clock) {
      clock.city = city;
    }
  }

  // Attach event listeners to clock cards
  function attachEventListeners() {
    clocksContainer.querySelectorAll(".remove-btn").forEach(btn => {
      btn.onclick = e => {
        const id = parseInt(e.target.closest(".clock-card").dataset.id);
        removeClock(id);
      };
    });
    clocksContainer.querySelectorAll(".city-select").forEach(select => {
      select.onchange = e => {
        const id = parseInt(e.target.closest(".clock-card").dataset.id);
        onCityChange(id, e.target.value);
      };
    });
  }

  // Time Difference Calculator
  const calcResult = document.getElementById("calcResult");
  function updateCalcResult() {
    const baseCityName = baseCitySelect.value;
    const targetCityName = targetCitySelect.value;
    const baseDateTimeValue = document.getElementById("baseDateTime").value;
    if (!baseDateTimeValue) {
      calcResult.textContent = "Please select a date and time.";
      return;
    }
    if (baseCityName === targetCityName) {
      calcResult.textContent = "Select two different cities.";
      return;
    }

    const baseCityData = cityList.find(c => c.city === baseCityName);
    const targetCityData = cityList.find(c => c.city === targetCityName);
    if (!baseCityData || !targetCityData) {
      calcResult.textContent = "Invalid city selection.";
      return;
    }

    // Parse base date-time as if in base city's timezone
    const baseDateTimeLocal = new Date(baseDateTimeValue);
    // Convert base local datetime to UTC timestamp by adjusting timezone offset
    const baseInUTC = new Date(baseDateTimeLocal.toLocaleString("en-US", { timeZone: "UTC" }));

    // Calculate equivalent date-time in target timezone
    const baseAsISO = baseDateTimeValue + ":00"; // Add seconds to satisfy ISO string
    const baseDateObj = new Date(baseAsISO);
    // Convert baseDateObj assumed in local time of base city, convert to UTC:
    const utcTime = new Date(baseDateObj.toLocaleString("en-US", { timeZone: "UTC" }));

    // Convert to target timezone local time string
    const targetTimeStr = utcTime.toLocaleString("en-US", { timeZone: targetCityData.tz });
    const targetDate = new Date(targetTimeStr);

    // Calculate difference in milliseconds
    const diffMs = targetDate.getTime() - baseDateObj.getTime();
    const diffH = Math.floor(diffMs / (1000 * 60 * 60));
    const diffM = Math.floor((diffMs % (1000 * 
