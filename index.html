<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="World Clock showing analog and digital times with timezone info, city selection, and time difference calculator." />
<title>World Clock & Time Calculator</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    background: #f9f9f9;
    color: #222;
    margin: 0; padding: 1rem;
  }
  h1 {
    text-align: center;
    color: #007acc;
  }
  .clocks-container {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    gap: 2rem;
    margin-bottom: 2rem;
  }
  .clock {
    background: white;
    border: 3px solid #007acc;
    border-radius: 1rem;
    padding: 1rem;
    width: 240px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    text-align: center;
  }
  .analog-face {
    position: relative;
    width: 200px;
    height: 200px;
    margin: 0 auto 1rem;
    border: 6px solid #007acc;
    border-radius: 50%;
    background: #fff;
  }
  .analog-number {
    position: absolute;
    font-weight: 600;
    color: #007acc;
    user-select: none;
    font-size: 1.3rem;
    transform-origin: center center;
  }
  .digital-time {
    font-size: 1.5rem;
    font-weight: 700;
    color: #222;
    margin-bottom: 0.3rem;
    font-family: monospace;
  }
  .tz-info {
    font-size: 0.9rem;
    color: #555;
  }
  select, input[type=date], input[type=time] {
    font-size: 1rem;
    padding: 0.4rem;
    margin: 0.5rem 0;
    width: 100%;
    max-width: 280px;
  }
  .calculator {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    border: 2px solid #007acc;
    border-radius: 1rem;
    padding: 1rem;
  }
  label {
    font-weight: 600;
    display: block;
    margin-top: 1rem;
  }
  button {
    margin-top: 1rem;
    background: #007acc;
    color: white;
    border: none;
    padding: 0.7rem 1.2rem;
    font-size: 1.1rem;
    cursor: pointer;
    border-radius: 0.5rem;
  }
  button:hover {
    background: #005fa3;
  }
</style>
</head>
<body>

<h1>World Clock & Time Calculator</h1>

<div class="clocks-container" id="clocksContainer">
  <!-- Default clocks inserted by JS -->
</div>

<div class="calculator" aria-label="Time difference calculator">
  <h2>Calculate Time Difference</h2>
  <label for="calcCityA">City A:</label>
  <select id="calcCityA"></select>

  <label for="calcCityB">City B:</label>
  <select id="calcCityB"></select>

  <label for="calcDate">Date:</label>
  <input type="date" id="calcDate" />

  <label for="calcTime">Time:</label>
  <input type="time" id="calcTime" />

  <button id="calcButton">Calculate Difference</button>

  <p id="calcResult" aria-live="polite"></p>
</div>

<script>
  const cities = [
    { id: 'america_new_york', name: 'New York', tz: 'America/New_York' },
    { id: 'europe_london', name: 'London', tz: 'Europe/London' },
    { id: 'asia_tokyo', name: 'Tokyo', tz: 'Asia/Tokyo' },
    // add more cities here...
  ];

  const defaultClocks = ['america_new_york', 'europe_london', 'asia_tokyo'];

  // Place numbers 1-12 evenly around the analog clock face
  function placeNumbers(face) {
    const radius = 85; // radius for number placement inside 100x100 center circle
    const centerX = 100, centerY = 100;
    for(let i=1; i<=12; i++) {
      let angle = (i * 30 - 90) * Math.PI / 180; // offset so 12 is at top
      let x = centerX + radius * Math.cos(angle);
      let y = centerY + radius * Math.sin(angle);
      const span = document.createElement('span');
      span.textContent = i;
      span.className = 'analog-number';
      span.style.left = `${x}px`;
      span.style.top = `${y}px`;
      span.style.transform = 'translate(-50%, -50%)';
      face.appendChild(span);
    }
  }

  function createClock(city) {
    const container = document.createElement('div');
    container.className = 'clock';
    container.setAttribute('aria-label', `Clock for ${city.name}`);

    // Analog clock face
    const face = document.createElement('div');
    face.className = 'analog-face';
    face.style.position = 'relative';
    placeNumbers(face);

    // Clock hands container
    const hands = document.createElement('div');
    hands.style.position = 'absolute';
    hands.style.left = '50%';
    hands.style.top = '50%';
    hands.style.width = '100%';
    hands.style.height = '100%';
    hands.style.transform = 'translate(-50%, -50%)';

    ['hour', 'minute', 'second'].forEach(hand => {
      const el = document.createElement('div');
      el.className = `hand hand-${hand}`;
      el.style.position = 'absolute';
      el.style.background = (hand === 'second') ? '#d00' : '#007acc';
      el.style.borderRadius = '2px';
      el.style.transformOrigin = 'bottom center';
      el.style.bottom = '50%';
      el.style.left = '50%';
      el.style.width = hand === 'second' ? '2px' : '4px';
      el.style.height = hand === 'second' ? '45px' : (hand === 'minute' ? '35px' : '25px');
      el.style.transform = 'rotate(0deg)';
      hands.appendChild(el);
    });

    face.appendChild(hands);
    container.appendChild(face);

    // Digital time display
    const digital = document.createElement('div');
    digital.className = 'digital-time';
    container.appendChild(digital);

    // Timezone info
    const tzinfo = document.createElement('div');
    tzinfo.className = 'tz-info';
    tzinfo.textContent = city.tz;
    container.appendChild(tzinfo);

    return { container, digital, hands };
  }

  const clocksContainer = document.getElementById('clocksContainer');
  const clocks = [];

  function updateClocks() {
    const now = new Date();
    clocks.forEach(({ city, digital, hands }) => {
      // Using Intl.DateTimeFormat for local city time
      const options = { timeZone: city.tz, hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' };
      const formatter = new Intl.DateTimeFormat([], options);
      const parts = formatter.formatToParts(now);
      const timeParts = {};
      parts.forEach(p => { if(p.type !== 'literal') timeParts[p.type] = p.value; });

      digital.textContent = `${timeParts.hour}:${timeParts.minute}:${timeParts.second}`;

      // Update analog hands rotation
      const hour = parseInt(timeParts.hour, 10) % 12;
      const minute = parseInt(timeParts.minute, 10);
      const second = parseInt(timeParts.second, 10);

      // Calculate angles
      const hourAngle = (hour * 30) + (minute * 0.5);
      const minuteAngle = minute * 6;
      const secondAngle = second * 6;

      hands.querySelector('.hand-hour').style.transform = `rotate(${hourAngle}deg)`;
      hands.querySelector('.hand-minute').style.transform = `rotate(${minuteAngle}deg)`;
      hands.querySelector('.hand-second').style.transform = `rotate(${secondAngle}deg)`;
    });
  }

  // Initialize clocks
  function init() {
    for(const cityId of defaultClocks){
      const city = cities.find(c=>c.id===cityId);
      if(city){
        const clockObj = createClock(city);
        clocksContainer.appendChild(clockObj.container);
        clocks.push({ city, ...clockObj });
      }
    }
    updateClocks();
    setInterval(updateClocks, 1000);

    // Populate calculator selects
    const calcCityA = document.getElementById('calcCityA');
    const calcCityB = document.getElementById('calcCityB');
    for(const c of cities){
      let optA = document.createElement('option'); optA.value = c.id; optA.textContent = c.name; calcCityA.appendChild(optA);
      let optB = document.createElement('option'); optB.value = c.id; optB.textContent = c.name; calcCityB.appendChild(optB);
    }
    calcCityA.value = defaultClocks[0];
    calcCityB.value = defaultClocks[1];

    // Set default date/time to now
    const nowISO = new Date().toISOString();
    document.getElementById('calcDate').value = nowISO.slice(0,10);
    document.getElementById('calcTime').value = nowISO.slice(11,16);

    document.getElementById('calcButton').addEventListener('click', () => {
      const cityA = cities.find(c => c.id === calcCityA.value);
      const cityB = cities.find(c => c.id === calcCityB.value);
      if(!cityA || !cityB) return;

      const dateStr = document.getElementById('calcDate').value;
      const timeStr = document.getElementById('calcTime').value;
      if(!dateStr || !timeStr) return;

      // Construct date/time in city A timezone (approximate, using UTC offset)
      // Note: This is a rough calculation for demo purposes
      const dateTime = new Date(`${dateStr}T${timeStr}:00Z`);

      const tzA = Intl.DateTimeFormat('en-US', {timeZone: cityA.tz, timeZoneName:'short'}).formatToParts(dateTime).find(p=>p.type==='timeZoneName')?.value || '';
      const tzB = Intl.DateTimeFormat('en-US', {timeZone: cityB.tz, timeZoneName:'short'}).formatToParts(dateTime).find(p=>p.type==='timeZoneName')?.value || '';

      // Get offsets by creating times in each zone
      function getOffsetMinutes(tz, date) {
        return -date.toLocaleString('en-US', {timeZone: tz, hour12:false})
          .split(':').map(Number).reduce((h,m)=>h*60+m,0);
      }

      // Better to use Date.toLocaleString with timeZone and convert to timestamp diff
      // Here's a simplified approach:
      const utcTimestamp = dateTime.getTime();

      const cityATime = new Date(dateTime.toLocaleString('en-US', {timeZone: cityA.tz}));
      const cityBTime = new Date(dateTime.toLocaleString('en-US', {timeZone: cityB.tz}));
      const diffMs = cityBTime.getTime() - cityATime.getTime();
      const diffH = diffMs / 3600000;

      document.getElementById('calcResult').textContent =
        `At ${timeStr} on ${dateStr} in ${cityA.name}, the time in ${cityB.name} is ${cityBTime.toTimeString().slice(0,5)} (${tzB}). Difference: ${diffH.toFixed(2)} hours.`;
    });
  }

  init();
</script>

</body>
</html>
